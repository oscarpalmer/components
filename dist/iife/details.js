"use strict";(()=>{var C=Object.defineProperty;var O=(n,e,t)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>(O(n,typeof e!="symbol"?e+"":e,t),t);var T=Math.round(16.666666666666668),S=cancelAnimationFrame!=null?cancelAnimationFrame:function(n){clearTimeout==null||clearTimeout(n)},A=requestAnimationFrame!=null?requestAnimationFrame:function(n){var e;return(e=setTimeout==null?void 0:setTimeout(()=>{n(Date.now())},T))!=null?e:-1},y=class{constructor(n,e,t){f(this,"callback");f(this,"count");f(this,"frame");f(this,"running",!1);f(this,"time");let i=this instanceof w,s=i?"repeated":"waited";if(typeof n!="function")throw new Error(`A ${s} timer must have a callback function`);if(typeof e!="number"||e<0)throw new Error(`A ${s} timer must have a non-negative number as its time`);if(i&&(typeof t!="number"||t<2))throw new Error("A repeated timer must have a number above 1 as its repeat count");this.callback=n,this.count=t,this.time=e}get active(){return this.running}static run(n){n.running=!0;let e=0,t;function i(s){if(!n.running)return;t!=null||(t=s);let o=s-t,r=o-T,c=o+T;if(r<n.time&&n.time<c)if(n.running&&n.callback(n instanceof w?e:void 0),e+=1,n instanceof w&&e<n.count)t=void 0;else{n.stop();return}n.frame=A(i)}n.frame=A(i)}restart(){return this.stop(),y.run(this),this}start(){return this.running?this:(y.run(this),this)}stop(){return this.running=!1,typeof this.frame=="undefined"?this:(S(this.frame),this.frame=void 0,this)}},w=class extends y{},q=class extends y{constructor(n,e){super(n,e,1)}};function D(n,e){return new q(n,e).start()}var k={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},K=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","embed","iframe","input","object","select","textarea","video[controls]"],B=K.map(n=>`${n}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function H(n,e){let t=typeof e=="string";if(t?n.matches(e):e(n))return n;let i=n==null?void 0:n.parentElement;for(;i!=null;){if(i===document.body)return;if(t?i.matches(e):e(i))break;i=i.parentElement}return i!=null?i:void 0}function M(n,e,t){let i=n.getAttribute(e);return i==null||i.trim().length===0?t:i}function x(n,e,t){t==null?n.removeAttribute(e):n.setAttribute(e,String(t))}var l=class{static destroyList(e){var o;let{children:t,observer:i,open:s}=a.list;t.delete(e),s.delete(e),(o=i.get(e))==null||o.disconnect(),i.delete(e)}static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static initializeList(e){var o;let{children:t,observer:i,open:s}=a.list;t.set(e,l.getChildren(e)),s.set(e,[]),i.set(e,new MutationObserver(r=>{g.callback(e,r)})),(o=i.get(e))==null||o.observe(e,g.options),l.open(e,M(e,"open",""))}static onGlobalKeydown(e){if(e.key!=="Escape")return;let{containers:t}=a.details,i=H(document.activeElement,s=>{var o,r;return t.has(s)&&((r=(o=t.get(s))==null?void 0:o.open)!=null?r:!0)});i instanceof m&&l.onToggle.call(i,!1)}static onLocalKeydown(e){var d;if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof E))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let i=(d=a.list.children.get(this))!=null?d:[],s=t.parentElement,o=i.indexOf(s);if(o===-1)return;let r=o+(e.key==="ArrowDown"?1:-1);r<0?r=i.length-1:r>=i.length&&(r=0);let c=i[r],h=c==null?void 0:c.querySelector(":scope > summary");h==null||h.focus()}static onToggle(e){var o;if(!(this instanceof m))return;let{buttons:t,containers:i}=a.details,s=i.get(this);s!=null&&(s.open=e!=null?e:!s.open,s.open||(o=t.get(this))==null||o.focus())}static open(e,t){if(t==null){l.update(e,[]);return}if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let i=t.length>0?t.split(",").filter(s=>s.trim().length>0).map(s=>Number.parseInt(s,10)):[];l.update(e,i)}static update(e,t){var d,b;if(typeof t=="undefined")return;let{children:i,observer:s,open:o}=a.list,r=t.filter((u,p,v)=>v.indexOf(u)===p).sort((u,p)=>u-p);e.multiple||(r=r.length>0&&r[0]!=null?r.length>1?[r[0]]:r:[]);let c=e.open;if(r.length===c.length&&r.every((u,p)=>c[p]===u))return;(d=s.get(e))==null||d.disconnect();let h=(b=i.get(e))!=null?b:[];for(let u of h)r.includes(h.indexOf(u))!==u.open&&(u.open=!u.open);D(()=>{o.set(e,r),x(e,"open",r.length===0?null:r),e.dispatchEvent(new Event("toggle")),D(()=>{var u;return(u=s.get(e))==null?void 0:u.observe(e,g.options)},0)},0)}},g=class{static callback(e,t){var u,p,v;if(t.length===0)return;let{children:i}=a.list,s=t[0],o=Array.from((u=s==null?void 0:s.addedNodes)!=null?u:[]),r=Array.from((p=s==null?void 0:s.removedNodes)!=null?p:[]);if(o.concat(r).some(L=>L.parentElement===e)){i.set(e,l.getChildren(e));return}if((s==null?void 0:s.type)!=="attributes"||!((s==null?void 0:s.target)instanceof HTMLDetailsElement))return;let c=s.target,d=((v=i.get(e))!=null?v:[]).indexOf(c);if(d===-1)return;let b=[];e.multiple?b=c.open?e.open.concat([d]):e.open.filter(L=>L!==d):b=c.open?[d]:[],l.update(e,b)}};f(g,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var a=class{};f(a,"details",{buttons:new WeakMap,containers:new WeakMap}),f(a,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var m=class extends HTMLElement{get open(){var e,t;return(t=(e=a.details.containers.get(this))==null?void 0:e.open)!=null?t:!1}set open(e){l.onToggle.call(this,e)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e==null?void 0:e.querySelector(":scope > summary");a.details.buttons.set(this,t),a.details.containers.set(this,e)}disconnectedCallback(){a.details.buttons.delete(this),a.details.containers.delete(this)}toggle(){l.onToggle.call(this)}},E=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){x(this,"multiple",e?"":null)}get open(){var e;return(e=a.list.open.get(this))!=null?e:[]}set open(e){l.update(this,e)}constructor(){super(),this.addEventListener("keydown",l.onLocalKeydown.bind(this),k.passive)}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multiple":l.open(this,M(this,"open",""));break;case"open":l.open(this,i);break;default:break}}connectedCallback(){l.initializeList(this)}disconnectedCallback(){l.destroyList(this)}};globalThis.addEventListener("keydown",l.onGlobalKeydown,k.passive);globalThis.customElements.define("delicious-details",m);globalThis.customElements.define("delicious-details-list",E);})();
