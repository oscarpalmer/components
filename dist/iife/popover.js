"use strict";(()=>{var W=Object.defineProperty;var q=(t,e,n)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>(q(t,typeof e!="symbol"?e+"":e,n),n);var w=Math.round(16.666666666666668),k=requestAnimationFrame!=null?requestAnimationFrame:function(t){var e;return(e=setTimeout==null?void 0:setTimeout(()=>{t(Date.now())},w))!=null?e:-1},p=class{constructor(t,e,n,o){c(this,"callbacks");c(this,"configuration");c(this,"state",{active:!1,finished:!1});let i=this instanceof T,r=i?"repeated":"waited";if(typeof t!="function")throw new Error(`A ${r} timer must have a callback function`);if(typeof e!="number"||e<0)throw new Error(`A ${r} timer must have a non-negative number as its time`);if(i&&(typeof n!="number"||n<2))throw new Error("A repeated timer must have a number above 1 as its repeat count");if(i&&o!=null&&typeof o!="function")throw new Error("A repeated timer's after-callback must be a function");this.configuration={count:n,time:e},this.callbacks={after:o,default:t}}get active(){return this.state.active}get finished(){return!this.state.active&&this.state.finished}static run(t){t.state.active=!0,t.state.finished=!1;let e=t instanceof T,n=0,o;function i(r){if(!t.state.active)return;o!=null||(o=r);let l=r-o,s=l-w,m=l+w;if(s<t.configuration.time&&t.configuration.time<m)if(t.state.active&&t.callbacks.default(e?n:void 0),n+=1,e&&n<t.configuration.count)o=void 0;else{t.state.finished=!0,t.stop();return}t.state.frame=k(i)}t.state.frame=k(i)}restart(){return this.stop(),p.run(this),this}start(){return this.state.active||p.run(this),this}stop(){var t,e,n;return this.state.active=!1,typeof this.state.frame=="undefined"?this:((t=cancelAnimationFrame!=null?cancelAnimationFrame:clearTimeout)==null||t(this.state.frame),(n=(e=this.callbacks).after)==null||n.call(e,this.finished),this.state.frame=void 0,this)}},T=class extends p{},B=class extends p{constructor(t,e){super(t,e,1)}};function A(t,e,n,o){return new T(t,e,n,o).start()}function f(t,e){return new B(t,e).start()}var d={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},z=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","embed","iframe","input","object","select","textarea","video[controls]"],_=z.map(t=>`${t}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function M(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1})}function g(t,e){let n=typeof e=="string";if(n?t.matches(e):e(t))return t;let o=t==null?void 0:t.parentElement;for(;o!=null;){if(o===document.body)return;if(n?o.matches(e):e(o))break;o=o.parentElement}return o!=null?o:void 0}function v(t){var o;let e=[],n=Array.from(t.querySelectorAll(_));for(let i of n){let r=(o=globalThis.getComputedStyle)==null?void 0:o.call(globalThis,i);(r==null||r.display!=="none"&&r.visibility!=="hidden")&&e.push(i)}return e}function E(t){return t==null?!0:t.trim().length===0}function a(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,String(n))}function x(t,e,n){t.setAttribute(e,String(typeof n=="boolean"?n:!1))}var R=["above","above-left","above-right","below","below-left","below-right","horizontal","left","right","vertical"];function j(t,e){let{left:n,right:o}=t.anchor,{width:i}=t.floater;switch(e){case"above":case"below":case"vertical":return n+t.anchor.width/2-i/2;case"above-left":case"below-left":return n;case"above-right":case"below-right":return o-i;case"horizontal":return o+i>globalThis.innerWidth?n-i<0?o:n-i:o;case"left":return n-i;case"right":return o;default:return 0}}function D(t,e){let{bottom:n,top:o}=t.anchor,{height:i}=t.floater;switch(e){case"above":case"above-left":case"above-right":return o-i;case"below":case"below-left":case"below-right":return n;case"horizontal":case"left":case"right":return o+t.anchor.height/2-i/2;case"vertical":return n+i>globalThis.innerHeight?o-i<0?n:o-i:n;default:return 0}}function N(t,e){var i;if(t==null)return e;let n=t.trim().toLowerCase(),o=R.indexOf(n);return o>-1&&(i=R[o])!=null?i:e}function O(t,e){let{anchor:n,floater:o,parent:i}=t;function r(){n.insertAdjacentElement("afterend",o)}function l(){var H;let s=N((H=(i!=null?i:n).getAttribute(e.attribute))!=null?H:"",e.value);o.setAttribute("position",s);let m={anchor:n.getBoundingClientRect(),floater:o.getBoundingClientRect()},K=D(m,s),I=`matrix(1, 0, 0, 1, ${j(m,s)}, ${K})`;o.style.position="fixed",o.style.inset="0 auto auto 0",o.style.transform=I}return document.body.appendChild(o),o.hidden=!1,A(l,0,1/0,r)}var u="formal-focus-trap",y=new WeakMap;function G(t,e,n){var l;let o=v(e);if(n===e){f(()=>{var s;((s=o[t.shiftKey?o.length-1:0])!=null?s:e).focus()},0);return}let i=o.indexOf(n),r=e;if(i>-1){let s=i+(t.shiftKey?-1:1);s<0?s=o.length-1:s>=o.length&&(s=0),r=(l=o[s])!=null?l:e}f(()=>{r.focus()},0)}function V(t){for(let e of t){if(e.type!=="attributes")continue;let n=e.target;n.getAttribute(u)==null?b.destroy(n):b.create(n)}}function J(t){if(t.key!=="Tab")return;let e=t.target,n=g(e,`[${u}]`);n!=null&&(t.preventDefault(),t.stopImmediatePropagation(),G(t,n,e))}var b=class{constructor(e){c(this,"tabIndex");this.tabIndex=e.tabIndex,a(e,"tabindex","-1")}static create(e){y.has(e)||y.set(e,new b(e))}static destroy(e){let n=y.get(e);n!=null&&(a(e,"tabindex",n.tabIndex),y.delete(e))}};(()=>{if(typeof globalThis._formalFocusTrap!="undefined")return;globalThis._formalFocusTrap=null,new MutationObserver(V).observe(document,{attributeFilter:[u],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),f(()=>{let e=Array.from(document.querySelectorAll(`[${u}]`));for(let n of e)n.setAttribute(u,"")},0),document.addEventListener("keydown",J,d.active)})();var $=new WeakMap,C=new WeakMap,Q=0;function S(t,e){var n,o,i;U(t,e),e&&t.content?((o=(n=v(t.content))==null?void 0:n[0])!=null?o:t.content).focus():(i=t.button)==null||i.focus()}function U(t,e){let n=$.get(t),o=C.get(t);if(n==null||o==null)return;let i=e?"addEventListener":"removeEventListener";document[i]("click",n,d.passive),document[i]("keydown",o,d.passive)}function F(t,e,n){let{button:o,content:i}=e;if(o==null||i==null)return;let r=g(n,"[polite-popover-content]");if(r==null){L(e,!1);return}t.stopPropagation();let l=Array.from(document.body.children);l.indexOf(r)-l.indexOf(i)<(t instanceof KeyboardEvent?1:0)&&L(e,!1)}function L(t,e){var o,i;let n=typeof e=="boolean"?!e:t.open;x(t.button,"aria-expanded",!n),n?(t.content.hidden=!0,(o=t.timer)==null||o.stop(),S(t,!1)):((i=t.timer)==null||i.stop(),t.timer=O({anchor:t.button,floater:t.content,parent:t},{attribute:"position",value:"below-left"}),f(()=>{S(t,!0)},50)),t.dispatchEvent(new Event("toggle"))}function X(t,e,n){n.hidden=!0,E(t.id)&&a(t,"id",`polite_popover_${++Q}`),E(e.id)&&a(e,"id",`${t.id}_button`),E(n.id)&&a(n,"id",`${t.id}_content`),a(e,"aria-controls",n.id),x(e,"aria-expanded",!1),a(e,"aria-haspopup","dialog"),e instanceof HTMLButtonElement||a(e,"tabindex","0"),a(n,u,""),a(n,"role","dialog"),a(n,"aria-modal","false"),$.set(t,Y.bind(t)),C.set(t,Z.bind(t)),e.addEventListener("click",P.bind(t),d.passive)}function Y(t){this instanceof h&&this.open&&F(t,this,t.target)}function Z(t){this instanceof h&&this.open&&t instanceof KeyboardEvent&&t.key==="Escape"&&F(t,this,document.activeElement)}function P(t){this instanceof h&&L(this,t)}var h=class extends HTMLElement{constructor(){super();c(this,"button");c(this,"content");c(this,"timer");let n=this.querySelector(":scope > [polite-popover-button]"),o=this.querySelector(":scope > [polite-popover-content]");if(n==null||!(n instanceof HTMLButtonElement||n instanceof HTMLElement&&n.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(o==null||!(o instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");M(this,"button",n),M(this,"content",o),X(this,n,o)}get open(){var n;return((n=this.button)==null?void 0:n.getAttribute("aria-expanded"))==="true"}set open(n){P.call(this,n)}toggle(){this.button&&this.content&&P.call(this)}};globalThis.customElements.define("polite-popover",h);})();
