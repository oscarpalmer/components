"use strict";(()=>{var O=Object.defineProperty;var C=(r,e,t)=>e in r?O(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var y=(r,e,t)=>(C(r,typeof e!="symbol"?e+"":e,t),t);var v={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},R=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","input","select","textarea","video[controls]"],S=R.map(r=>`${r}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function d(r){var e,t,o;return(o=(e=globalThis.requestAnimationFrame)==null?void 0:e.call(globalThis,r))!=null?o:(t=globalThis.setTimeout)==null?void 0:t.call(globalThis,()=>{r(Date.now())},16)}function T(r,e){let t=typeof e=="string";if(t?r.matches(e):e(r))return r;let o=r==null?void 0:r.parentElement;for(;o!=null;){if(o===document.body)return;if(t?o.matches(e):e(o))break;o=o.parentElement}return o!=null?o:void 0}function w(r){var o;let e=[],t=Array.from(r.querySelectorAll(S));for(let n of t){let i=(o=globalThis.getComputedStyle)==null?void 0:o.call(globalThis,n);(i==null||i.display!=="none"&&i.visibility!=="hidden")&&e.push(n)}return e}function L(r){return r==null?!0:r.trim().length===0}function s(r,e,t){t==null?r.removeAttribute(e):r.setAttribute(e,String(t))}function H(r,e,t){r.setAttribute(e,String(typeof t=="boolean"?t:!1))}var P=["above","above-left","above-right","below","below-left","below-right","horizontal","left","right","vertical"],f=class{static update(e,t){let{anchor:o,floater:n,parent:i}=e;function u(){var k;if(n.hidden){o.insertAdjacentElement("afterend",n);return}let h=f.getPosition((k=(i!=null?i:o).getAttribute("position"))!=null?k:"",t),a={anchor:o.getBoundingClientRect(),floater:n.getBoundingClientRect()},M=f.getTop(a,h),A=`matrix(1, 0, 0, 1, ${f.getLeft(a,h)}, ${M})`;n.style.position="fixed",n.style.inset="0 auto auto 0",n.style.transform=A,d(u)}document.body.appendChild(n),n.hidden=!1,d(u)}static getLeft(e,t){let{left:o,right:n}=e.anchor,{width:i}=e.floater;switch(t){case"above":case"below":case"vertical":return o+e.anchor.width/2-i/2;case"above-left":case"below-left":return o;case"above-right":case"below-right":return n-i;case"horizontal":return n+i>globalThis.innerWidth?o-i<0?n:o-i:n;case"left":return o-i;case"right":return n;default:return 0}}static getTop(e,t){let{bottom:o,top:n}=e.anchor,{height:i}=e.floater;switch(t){case"above":case"above-left":case"above-right":return n-i;case"below":case"below-left":case"below-right":return o;case"horizontal":case"left":case"right":return n+e.anchor.height/2-i/2;case"vertical":return o+i>globalThis.innerHeight?n-i<0?o:n-i:o;default:return 0}}static getPosition(e,t){var i;if(e==null)return t;let o=e.trim().toLowerCase(),n=P.indexOf(o);return n>-1&&(i=P[n])!=null?i:t}};var b="formal-focus-trap",x=new WeakMap,g=class{static observer(e){for(let t of e){if(t.type!=="attributes")continue;let o=t.target;o.getAttribute(b)==null?m.destroy(o):m.create(o)}}static onKeydown(e){if(e.key!=="Tab")return;let t=e.target,o=T(t,`[${b}]`);o!=null&&(e.preventDefault(),e.stopImmediatePropagation(),g.handle(e,o,t))}static handle(e,t,o){var h;let n=w(t);if(o===t){d(()=>{var a;((a=n[e.shiftKey?n.length-1:0])!=null?a:t).focus()});return}let i=n.indexOf(o),u=t;if(i>-1){let a=i+(e.shiftKey?-1:1);a<0?a=n.length-1:a>=n.length&&(a=0),u=(h=n[a])!=null?h:t}d(()=>{u.focus()})}},m=class{constructor(e){y(this,"tabIndex");this.tabIndex=e.tabIndex,s(e,"tabindex","-1")}static create(e){x.has(e)||x.set(e,new m(e))}static destroy(e){let t=x.get(e);t!=null&&(s(e,"tabindex",t.tabIndex),x.delete(e))}};(()=>{if(typeof globalThis._formalFocusTrap!="undefined")return;globalThis._formalFocusTrap=null,new MutationObserver(g.observer).observe(document,{attributeFilter:[b],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),d(()=>{let e=Array.from(document.querySelectorAll(`[${b}]`));for(let t of e)t.setAttribute(b,"")}),document.addEventListener("keydown",g.onKeydown,v.active)})();var K=0,l=class{static initialize(e,t,o){o.hidden=!0,L(e.id)&&s(e,"id",`polite_popover_${K++}`),L(t.id)&&s(t,"id",`${e.id}_button`),L(o.id)&&s(o,"id",`${e.id}_content`),s(t,"aria-controls",o.id),H(t,"aria-expanded",!1),s(t,"aria-haspopup","dialog"),s(o,b,""),s(o,"role","dialog"),s(o,"aria-modal","false"),t.addEventListener("click",l.toggle.bind(e),v.passive)}static onClick(e){this instanceof E&&this.open&&l.handleGlobalEvent(e,this,e.target)}static onKeydown(e){this instanceof E&&this.open&&e instanceof KeyboardEvent&&e.key==="Escape"&&l.handleGlobalEvent(e,this,document.activeElement)}static toggle(e){let t=this instanceof E?c.elements.get(this):null;t!=null&&l.handleToggle(this,t,e)}static afterToggle(e,t,o){var n,i;l.handleCallbacks(e,o),o?((i=(n=w(t.floater))==null?void 0:n[0])!=null?i:t.floater).focus():t.anchor.focus()}static handleCallbacks(e,t){let o=c.callbacks.get(e);if(o==null)return;let n=t?"addEventListener":"removeEventListener";document[n]("click",o.click,v.passive),document[n]("keydown",o.keydown,v.passive)}static handleGlobalEvent(e,t,o){let n=c.elements.get(t);if(n==null)return;let i=T(o,"[polite-popover-content]");if(i==null){this.handleToggle(t,n,!1);return}e.stopPropagation();let u=Array.from(document.body.children);u.indexOf(i)-u.indexOf(n.floater)<(e instanceof KeyboardEvent?1:0)&&l.handleToggle(t,n,!1)}static handleToggle(e,t,o){let n=typeof o=="boolean"?!o:e.open;H(t.anchor,"aria-expanded",!n),n?(t.floater.hidden=!0,l.afterToggle(e,t,!1)):(f.update({anchor:t.anchor,floater:t.floater,parent:e},"below-left"),d(()=>{l.afterToggle(e,t,!0)})),e.dispatchEvent(new Event("toggle"))}},p=class{static add(e){let t=e.querySelector(":scope > [polite-popover-button]"),o=e.querySelector(":scope > [polite-popover-content]");t==null||o==null||(p.callbacks.set(e,{click:l.onClick.bind(e),keydown:l.onKeydown.bind(e)}),p.elements.set(e,{anchor:t,floater:o}))}static remove(e){var o;let t=p.elements.get(e);(t==null?void 0:t.floater)instanceof HTMLElement&&(t.floater.hidden=!0,(o=t.anchor)==null||o.insertAdjacentElement("afterend",t.floater)),p.callbacks.delete(e),p.elements.delete(e)}},c=p;y(c,"callbacks",new WeakMap),y(c,"elements",new WeakMap);var E=class extends HTMLElement{get button(){var e;return(e=c.elements.get(this))==null?void 0:e.anchor}get content(){var e;return(e=c.elements.get(this))==null?void 0:e.floater}get open(){var e;return((e=this.button)==null?void 0:e.getAttribute("aria-expanded"))==="true"}set open(e){l.toggle.call(this,e)}constructor(){super();let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null||!(e instanceof HTMLButtonElement||e instanceof HTMLElement&&e.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(t==null||!(t instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");l.initialize(this,e,t)}connectedCallback(){c.add(this)}disconnectedCallback(){c.remove(this)}toggle(){l.toggle.call(this)}};globalThis.customElements.define("polite-popover",E);})();
