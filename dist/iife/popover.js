"use strict";(()=>{var K=Object.defineProperty;var I=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>(I(t,typeof e!="symbol"?e+"":e,n),n);var w=Math.round(16.666666666666668),W=cancelAnimationFrame!=null?cancelAnimationFrame:function(t){clearTimeout==null||clearTimeout(t)},H=requestAnimationFrame!=null?requestAnimationFrame:function(t){var e;return(e=setTimeout==null?void 0:setTimeout(()=>{t(Date.now())},w))!=null?e:-1},p=class{constructor(t,e,n){l(this,"callback");l(this,"count");l(this,"frame");l(this,"running",!1);l(this,"time");let o=this instanceof m,i=o?"repeated":"waited";if(typeof t!="function")throw new Error(`A ${i} timer must have a callback function`);if(typeof e!="number"||e<0)throw new Error(`A ${i} timer must have a non-negative number as its time`);if(o&&(typeof n!="number"||n<2))throw new Error("A repeated timer must have a number above 1 as its repeat count");this.callback=t,this.count=n,this.time=e}get active(){return this.running}static run(t){t.running=!0;let e=0,n;function o(i){if(!t.running)return;n!=null||(n=i);let r=i-n,c=r-w,s=r+w;if(c<t.time&&t.time<s)if(t.running&&t.callback(t instanceof m?e:void 0),e+=1,t instanceof m&&e<t.count)n=void 0;else{t.stop();return}t.frame=H(o)}t.frame=H(o)}restart(){return this.stop(),p.run(this),this}start(){return this.running?this:(p.run(this),this)}stop(){return this.running=!1,typeof this.frame=="undefined"?this:(W(this.frame),this.frame=void 0,this)}},m=class extends p{},q=class extends p{constructor(t,e){super(t,e,1)}};function k(t,e,n){return new m(t,e,n).start()}function f(t,e){return new q(t,e).start()}var d={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},B=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","embed","iframe","input","object","select","textarea","video[controls]"],z=B.map(t=>`${t}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function T(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1})}function g(t,e){let n=typeof e=="string";if(n?t.matches(e):e(t))return t;let o=t==null?void 0:t.parentElement;for(;o!=null;){if(o===document.body)return;if(n?o.matches(e):e(o))break;o=o.parentElement}return o!=null?o:void 0}function v(t){var o;let e=[],n=Array.from(t.querySelectorAll(z));for(let i of n){let r=(o=globalThis.getComputedStyle)==null?void 0:o.call(globalThis,i);(r==null||r.display!=="none"&&r.visibility!=="hidden")&&e.push(i)}return e}function E(t){return t==null?!0:t.trim().length===0}function a(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,String(n))}function M(t,e,n){t.setAttribute(e,String(typeof n=="boolean"?n:!1))}var A=["above","above-left","above-right","below","below-left","below-right","horizontal","left","right","vertical"];function _(t,e){let{left:n,right:o}=t.anchor,{width:i}=t.floater;switch(e){case"above":case"below":case"vertical":return n+t.anchor.width/2-i/2;case"above-left":case"below-left":return n;case"above-right":case"below-right":return o-i;case"horizontal":return o+i>globalThis.innerWidth?n-i<0?o:n-i:o;case"left":return n-i;case"right":return o;default:return 0}}function j(t,e){let{bottom:n,top:o}=t.anchor,{height:i}=t.floater;switch(e){case"above":case"above-left":case"above-right":return o-i;case"below":case"below-left":case"below-right":return n;case"horizontal":case"left":case"right":return o+t.anchor.height/2-i/2;case"vertical":return n+i>globalThis.innerHeight?o-i<0?n:o-i:n;default:return 0}}function D(t,e){var i;if(t==null)return e;let n=t.trim().toLowerCase(),o=A.indexOf(n);return o>-1&&(i=A[o])!=null?i:e}function R(t,e){let{anchor:n,floater:o,parent:i}=t;return document.body.appendChild(o),o.hidden=!1,k(()=>{var P;if(o.hidden){n.insertAdjacentElement("afterend",o);return}let r=D((P=(i!=null?i:n).getAttribute(e.attribute))!=null?P:"",e.value);o.setAttribute("position",r);let c={anchor:n.getBoundingClientRect(),floater:o.getBoundingClientRect()},s=j(c,r),F=`matrix(1, 0, 0, 1, ${_(c,r)}, ${s})`;o.style.position="fixed",o.style.inset="0 auto auto 0",o.style.transform=F},0,1/0)}var u="formal-focus-trap",y=new WeakMap;function N(t,e,n){var c;let o=v(e);if(n===e){f(()=>{var s;((s=o[t.shiftKey?o.length-1:0])!=null?s:e).focus()},0);return}let i=o.indexOf(n),r=e;if(i>-1){let s=i+(t.shiftKey?-1:1);s<0?s=o.length-1:s>=o.length&&(s=0),r=(c=o[s])!=null?c:e}f(()=>{r.focus()},0)}function G(t){for(let e of t){if(e.type!=="attributes")continue;let n=e.target;n.getAttribute(u)==null?b.destroy(n):b.create(n)}}function V(t){if(t.key!=="Tab")return;let e=t.target,n=g(e,`[${u}]`);n!=null&&(t.preventDefault(),t.stopImmediatePropagation(),N(t,n,e))}var b=class{constructor(e){l(this,"tabIndex");this.tabIndex=e.tabIndex,a(e,"tabindex","-1")}static create(e){y.has(e)||y.set(e,new b(e))}static destroy(e){let n=y.get(e);n!=null&&(a(e,"tabindex",n.tabIndex),y.delete(e))}};(()=>{if(typeof globalThis._formalFocusTrap!="undefined")return;globalThis._formalFocusTrap=null,new MutationObserver(G).observe(document,{attributeFilter:[u],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),f(()=>{let e=Array.from(document.querySelectorAll(`[${u}]`));for(let n of e)n.setAttribute(u,"")},0),document.addEventListener("keydown",V,d.active)})();var C=new WeakMap,S=new WeakMap,J=0;function O(t,e){var n,o,i;Q(t,e),e&&t.content?((o=(n=v(t.content))==null?void 0:n[0])!=null?o:t.content).focus():(i=t.button)==null||i.focus()}function Q(t,e){let n=C.get(t),o=S.get(t);if(n==null||o==null)return;let i=e?"addEventListener":"removeEventListener";document[i]("click",n,d.passive),document[i]("keydown",o,d.passive)}function $(t,e,n){let{button:o,content:i}=e;if(o==null||i==null)return;let r=g(n,"[polite-popover-content]");if(r==null){x(e,!1);return}t.stopPropagation();let c=Array.from(document.body.children);c.indexOf(r)-c.indexOf(i)<(t instanceof KeyboardEvent?1:0)&&x(e,!1)}function x(t,e){var o,i;let n=typeof e=="boolean"?!e:t.open;M(t.button,"aria-expanded",!n),n?(t.content.hidden=!0,(o=t.timer)==null||o.stop(),O(t,!1)):((i=t.timer)==null||i.stop(),t.timer=R({anchor:t.button,floater:t.content,parent:t},{attribute:"position",value:"below-left"}),f(()=>{O(t,!0)},50)),t.dispatchEvent(new Event("toggle"))}function U(t,e,n){n.hidden=!0,E(t.id)&&a(t,"id",`polite_popover_${++J}`),E(e.id)&&a(e,"id",`${t.id}_button`),E(n.id)&&a(n,"id",`${t.id}_content`),a(e,"aria-controls",n.id),M(e,"aria-expanded",!1),a(e,"aria-haspopup","dialog"),e instanceof HTMLButtonElement||a(e,"tabindex","0"),a(n,u,""),a(n,"role","dialog"),a(n,"aria-modal","false"),C.set(t,X.bind(t)),S.set(t,Y.bind(t)),e.addEventListener("click",L.bind(t),d.passive)}function X(t){this instanceof h&&this.open&&$(t,this,t.target)}function Y(t){this instanceof h&&this.open&&t instanceof KeyboardEvent&&t.key==="Escape"&&$(t,this,document.activeElement)}function L(t){this instanceof h&&x(this,t)}var h=class extends HTMLElement{constructor(){super();l(this,"button");l(this,"content");l(this,"timer");let n=this.querySelector(":scope > [polite-popover-button]"),o=this.querySelector(":scope > [polite-popover-content]");if(n==null||!(n instanceof HTMLButtonElement||n instanceof HTMLElement&&n.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(o==null||!(o instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");T(this,"button",n),T(this,"content",o),U(this,n,o)}get open(){var n;return((n=this.button)==null?void 0:n.getAttribute("aria-expanded"))==="true"}set open(n){L.call(this,n)}toggle(){this.button&&this.content&&L.call(this)}};globalThis.customElements.define("polite-popover",h);})();
