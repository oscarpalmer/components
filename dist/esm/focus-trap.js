var m={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},y=["[href]","[tabindex]","button","input","select","textarea"].map(r=>`${r}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function a(r){return globalThis.requestAnimationFrame?.(r)??globalThis.setTimeout?.(()=>{r(Date.now())},16)}function p(r,t){let e=typeof t=="string";if(e?r.matches(t):t(r))return r;let n=r?.parentElement;for(;n!=null;){if(n===document.body)return;if(e?n.matches(t):t(n))break;n=n.parentElement}return n??void 0}function g(r){let t=[],e=Array.from(r.querySelectorAll(y));for(let n of e){let o=globalThis.getComputedStyle?.(n);(o==null||o.display!=="none"&&o.visibility!=="hidden")&&t.push(n)}return t}function d(r,t,e){e==null?r.removeAttribute(t):r.setAttribute(t,String(e))}var u="formal-focus-trap",c=new WeakMap,i=class{static observer(t){for(let e of t){if(e.type!=="attributes")continue;let n=e.target;n.getAttribute(u)==null?s.destroy(n):s.create(n)}}static onKeydown(t){if(t.key!=="Tab")return;let e=t.target,n=p(e,`[${u}]`);n!=null&&(t.preventDefault(),t.stopImmediatePropagation(),i.handle(t,n,e))}static handle(t,e,n){let o=g(e);if(n===e){a(()=>{(o[t.shiftKey?o.length-1:0]??e).focus()});return}let f=o.indexOf(n),b=e;if(f>-1){let l=f+(t.shiftKey?-1:1);l<0?l=o.length-1:l>=o.length&&(l=0),b=o[l]??e}a(()=>{b.focus()})}},s=class{tabIndex;constructor(t){this.tabIndex=t.tabIndex,d(t,"tabindex","-1")}static create(t){c.has(t)||c.set(t,new s(t))}static destroy(t){let e=c.get(t);e!=null&&(d(t,"tabindex",e.tabIndex),c.delete(t))}};(()=>{if(typeof globalThis._formalFocusTrap<"u")return;globalThis._formalFocusTrap=null,new MutationObserver(i.observer).observe(document,{attributeFilter:[u],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),a(()=>{let t=Array.from(document.querySelectorAll(`[${u}]`));for(let e of t)e.setAttribute(u,"")}),document.addEventListener("keydown",i.onKeydown,m.active)})();export{u as attribute};
