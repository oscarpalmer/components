var w=Object.defineProperty;var T=(l,e,t)=>e in l?w(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var b=(l,e,t)=>(T(l,typeof e!="symbol"?e+"":e,t),t);var y={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},k=["[href]","[tabindex]","button","input","select","textarea"].map(l=>`${l}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function E(l){return requestAnimationFrame?.(l)??setTimeout?.(()=>{l(Date.now())},16)}function D(l,e){let t=l?.parentElement;for(;t!=null;){if(t===document.body)return;if(e(t))break;t=t.parentElement}return t??void 0}function L(l,e,t){let i=l.getAttribute(e);return i==null||i.trim().length===0?t:i}function v(l,e,t){typeof t>"u"?l.removeAttribute(e):l.setAttribute(e,String(t))}var o=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static initializeList(e){let{children:t,connected:i,observer:s,open:u}=r.list;i.set(e),t.set(e,o.getChildren(e)),u.set(e,[]),s.set(e,new MutationObserver(n=>{f.callback(e,n)})),s.get(e)?.observe(e,f.options),e.addEventListener("keydown",o.onLocalKeydown.bind(e),y.passive),o.open(e,L(e,"open",""))}static onGlobalKeydown(e){if(e.key!=="Escape")return;let{containers:t}=r.details,i=D(document.activeElement,s=>t.has(s)&&(t.get(s)?.open??!0));i instanceof m&&o.onToggle.call(i,!1)}static onLocalKeydown(e){if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof g))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let i=r.list.children.get(this)??[],s=t.parentElement,u=i.indexOf(s);if(u===-1)return;let n=u+(e.key==="ArrowDown"?1:-1);n<0?n=i.length-1:n>=i.length&&(n=0),i[n]?.querySelector(":scope > summary")?.focus()}static onToggle(e){if(!(this instanceof m))return;let{buttons:t,containers:i}=r.details,s=i.get(this);typeof s>"u"||(s.open=e??!s.open,s.open||t.get(this)?.focus())}static open(e,t){if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let i=t.length>0?t.split(",").filter(s=>s.trim().length>0).map(s=>Number.parseInt(s,10)):[];o.update(e,i)}static update(e,t){if(typeof t>"u")return;let{children:i,observer:s,open:u}=r.list,n=t.filter((a,d,p)=>p.indexOf(a)===d).sort((a,d)=>a-d);if(e.multiple||(n=n.length>0&&n[0]!=null?n.length>1?[n[0]]:n:[]),n.every((a,d)=>e.open[d]===a))return;s.get(e)?.disconnect();let c=i.get(e)??[];for(let a of c)n.includes(c.indexOf(a))!==a.open&&(a.open=!a.open);u.set(e,n),E(()=>{let a=e.open!==n;v(e,"open",n.length===0?null:n),a&&e.dispatchEvent(new Event("toggle")),E(()=>s.get(e)?.observe(e,f.options))})}},f=class{static callback(e,t){if(t.length===0)return;let{children:i}=r.list,s=t[0],u=Array.from(s?.addedNodes??[]),n=Array.from(s?.removedNodes??[]);if(u.concat(n).some(h=>h.parentElement===e)){i.set(e,o.getChildren(e));return}if(s?.type!=="attributes"||!(s?.target instanceof HTMLDetailsElement))return;let c=s.target,d=(i.get(e)??[]).indexOf(c);if(d===-1)return;let p=[];e.multiple?p=c.open?e.open.concat([d]):e.open.filter(h=>h!==d):p=c.open?[d]:[],o.update(e,p)}};b(f,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var r=class{};b(r,"details",{buttons:new WeakMap,connected:new WeakMap,containers:new WeakMap}),b(r,"list",{children:new WeakMap,connected:new WeakMap,observer:new WeakMap,open:new WeakMap});var m=class extends HTMLElement{get open(){return r.details.containers.get(this)?.open??!1}set open(e){o.onToggle.call(this,e)}connectedCallback(){if(r.details.connected.has(this))return;let e=this.querySelector(":scope > details"),t=e?.querySelector(":scope > summary");r.details.connected.set(this),r.details.buttons.set(this,t),r.details.containers.set(this,e)}toggle(){o.onToggle.call(this)}},g=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){v(this,"multiple",e?"":null)}get open(){return r.list.open.get(this)??[]}set open(e){o.update(this,e)}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multiple":o.open(this,L(this,"open",""));break;case"open":o.open(this,i);break;default:break}}connectedCallback(){r.list.connected.has(this)||o.initializeList(this)}};addEventListener?.("keydown",o.onGlobalKeydown,y.passive);customElements?.define("delicious-details",m);customElements?.define("delicious-details-list",g);
