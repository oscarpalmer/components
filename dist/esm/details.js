var T=Object.defineProperty;var w=(s,e,t)=>e in s?T(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var m=(s,e,t)=>(w(s,typeof e!="symbol"?e+"":e,t),t);var y={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},k=["[href]","[tabindex]","button","input","select","textarea"].map(s=>`${s}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function E(s){return globalThis.requestAnimationFrame?.(s)??globalThis.setTimeout?.(()=>{s(Date.now())},16)}function D(s,e){let t=s?.parentElement;for(;t!=null;){if(t===document.body)return;if(e(t))break;t=t.parentElement}return t??void 0}function L(s,e,t){let i=s.getAttribute(e);return i==null||i.trim().length===0?t:i}function v(s,e,t){t==null?s.removeAttribute(e):s.setAttribute(e,String(t))}var r=class{static destroyList(e){let{children:t,observer:i,open:n}=o.list;t.delete(e),n.delete(e),i.get(e)?.disconnect(),i.delete(e)}static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static initializeList(e){let{children:t,observer:i,open:n}=o.list;t.set(e,r.getChildren(e)),n.set(e,[]),i.set(e,new MutationObserver(d=>{f.callback(e,d)})),i.get(e)?.observe(e,f.options),r.open(e,L(e,"open",""))}static onGlobalKeydown(e){if(e.key!=="Escape")return;let{containers:t}=o.details,i=D(document.activeElement,n=>t.has(n)&&(t.get(n)?.open??!0));i instanceof g&&r.onToggle.call(i,!1)}static onLocalKeydown(e){if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof h))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let i=o.list.children.get(this)??[],n=t.parentElement,d=i.indexOf(n);if(d===-1)return;let l=d+(e.key==="ArrowDown"?1:-1);l<0?l=i.length-1:l>=i.length&&(l=0),i[l]?.querySelector(":scope > summary")?.focus()}static onToggle(e){if(!(this instanceof g))return;let{buttons:t,containers:i}=o.details,n=i.get(this);n!=null&&(n.open=e??!n.open,n.open||t.get(this)?.focus())}static open(e,t){if(t==null){r.update(e,[]);return}if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let i=t.length>0?t.split(",").filter(n=>n.trim().length>0).map(n=>Number.parseInt(n,10)):[];r.update(e,i)}static update(e,t){if(typeof t>"u")return;let{children:i,observer:n,open:d}=o.list,l=t.filter((a,u,p)=>p.indexOf(a)===u).sort((a,u)=>a-u);e.multiple||(l=l.length>0&&l[0]!=null?l.length>1?[l[0]]:l:[]);let c=e.open;if(l.length===c.length&&l.every((a,u)=>c[u]===a))return;n.get(e)?.disconnect();let b=i.get(e)??[];for(let a of b)l.includes(b.indexOf(a))!==a.open&&(a.open=!a.open);E(()=>{d.set(e,l),v(e,"open",l.length===0?null:l),e.dispatchEvent(new Event("toggle")),E(()=>n.get(e)?.observe(e,f.options))})}},f=class{static callback(e,t){if(t.length===0)return;let{children:i}=o.list,n=t[0],d=Array.from(n?.addedNodes??[]),l=Array.from(n?.removedNodes??[]);if(d.concat(l).some(p=>p.parentElement===e)){i.set(e,r.getChildren(e));return}if(n?.type!=="attributes"||!(n?.target instanceof HTMLDetailsElement))return;let c=n.target,a=(i.get(e)??[]).indexOf(c);if(a===-1)return;let u=[];e.multiple?u=c.open?e.open.concat([a]):e.open.filter(p=>p!==a):u=c.open?[a]:[],r.update(e,u)}};m(f,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var o=class{};m(o,"details",{buttons:new WeakMap,containers:new WeakMap}),m(o,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var g=class extends HTMLElement{get open(){return o.details.containers.get(this)?.open??!1}set open(e){r.onToggle.call(this,e)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e?.querySelector(":scope > summary");o.details.buttons.set(this,t),o.details.containers.set(this,e)}disconnectedCallback(){o.details.buttons.delete(this),o.details.containers.delete(this)}toggle(){r.onToggle.call(this)}},h=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){v(this,"multiple",e?"":null)}get open(){return o.list.open.get(this)??[]}set open(e){r.update(this,e)}constructor(){super(),this.addEventListener("keydown",r.onLocalKeydown.bind(this),y.passive)}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multiple":r.open(this,L(this,"open",""));break;case"open":r.open(this,i);break;default:break}}connectedCallback(){r.initializeList(this)}disconnectedCallback(){r.destroyList(this)}};addEventListener?.("keydown",r.onGlobalKeydown,y.passive);customElements?.define("delicious-details",g);customElements?.define("delicious-details-list",h);
