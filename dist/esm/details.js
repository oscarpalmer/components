var L=Object.defineProperty;var D=(o,e,t)=>e in o?L(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>(D(o,typeof e!="symbol"?e+"":e,t),t);var y={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}};function v(o){return requestAnimationFrame?.(o)??setTimeout?.(()=>{o(Date.now())},16)}function E(o,e){let t=o?.parentElement;for(;t!=null;){if(t===document.body)return;if(e(t))break;t=t.parentElement}return t??void 0}var M=["[href]","[tabindex]","button","input","select","textarea"].map(o=>`${o}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");var l=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static onKeydown(e){if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof b))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let s=r.list.children.get(this)??[],i=t.parentElement,c=s.indexOf(i);if(c===-1)return;let n=c+(e.key==="ArrowDown"?1:-1);n<0?n=s.length-1:n>=s.length&&(n=0),s[n]?.querySelector(":scope > summary")?.focus()}static onKeyup(e){if(e.key!=="Escape")return;let{containers:t}=r.details,s=E(document.activeElement,i=>t.has(i)&&(t.get(i)?.open??!0));s instanceof m&&l.onToggle.call(s,!1)}static onToggle(e){if(!(this instanceof m))return;let{buttons:t,containers:s}=r.details,i=s.get(this);i!=null&&(i.open=e??!i.open,i.open||t.get(this)?.focus())}static open(e,t){if(t==null)return;if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let s=t.length>0?t.split(",").filter(i=>i.trim().length>0).map(i=>Number.parseInt(i,10)):[];l.update(e,s)}static update(e,t){if(typeof t>"u")return;let{children:s,observer:i,open:c}=r.list,n=t.filter((a,d,f)=>f.indexOf(a)===d).sort((a,d)=>a-d);if(e.multiple||(n=n.length>0&&n[0]!=null?n.length>1?[n[0]]:n:[]),n.every((a,d)=>e.open[d]===a))return;i.get(e)?.disconnect();let u=s.get(e)??[];for(let a of u)n.includes(u.indexOf(a))!==a.open&&(a.open=!a.open);c.set(e,n),v(()=>{n.length===0?e.removeAttribute("open"):e.setAttribute("open",n.join(",")),v(()=>i.get(e)?.observe(e,p.options))})}},p=class{static callback(e,t){if(t.length===0)return;let{children:s}=r.list,i=t[0],c=Array.from(i?.addedNodes??[]),n=Array.from(i?.removedNodes??[]);if(c.concat(n).some(g=>g.parentElement===e)){s.set(e,l.getChildren(e));return}if(i?.type!=="attributes"||!(i?.target instanceof HTMLDetailsElement))return;let u=i.target,d=(s.get(e)??[]).indexOf(u);if(d===-1)return;let f=[];e.multiple?f=u.open?e.open.concat([d]):e.open.filter(g=>g!==d):f=u.open?[d]:[],l.update(e,f)}};h(p,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var r=class{};h(r,"details",{buttons:new WeakMap,containers:new WeakMap}),h(r,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var m=class extends HTMLElement{close(){l.onToggle.call(this,!1)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e?.querySelector(":scope > summary");r.details.buttons.set(this,t),r.details.containers.set(this,e)}disconnectedCallback(){r.details.buttons.delete(this),r.details.containers.delete(this)}open(){l.onToggle.call(this,!0)}toggle(){l.onToggle.call(this)}},b=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){e?this.setAttribute("multiple",""):this.removeAttribute("multiple")}get open(){return r.list.open.get(this)??[]}set open(e){l.update(this,e)}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"multiple":l.open(this,this.getAttribute("open")??void 0);break;case"open":l.open(this,s);break;default:break}}connectedCallback(){let{children:e,observer:t,open:s}=r.list;e.set(this,l.getChildren(this)),s.set(this,[]),t.set(this,new MutationObserver(i=>{p.callback(this,i)})),t.get(this)?.observe(this,p.options),this.addEventListener("keydown",l.onKeydown.bind(this),y.passive),l.open(this,this.getAttribute("open")??void 0)}disconnectedCallback(){let{children:e,observer:t,open:s}=r.list;e.delete(this),t.get(this)?.disconnect(),t.delete(this),s.delete(this)}};addEventListener?.("keyup",l.onKeyup,y.passive);customElements?.define("delicious-details",m);customElements?.define("delicious-details-list",b);
