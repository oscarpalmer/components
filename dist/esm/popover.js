var R=Object.defineProperty;var $=(o,e,t)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var x=(o,e,t)=>($(o,typeof e!="symbol"?e+"":e,t),t);var b={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},O=["[href]","[tabindex]","button","input","select","textarea"].map(o=>`${o}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function d(o){return globalThis.requestAnimationFrame?.(o)??globalThis.setTimeout?.(()=>{o(Date.now())},16)}function w(o,e){let t=typeof e=="string";if(t?o.matches(e):e(o))return o;let n=o?.parentElement;for(;n!=null;){if(n===document.body)return;if(t?n.matches(e):e(n))break;n=n.parentElement}return n??void 0}function A(o,e,t){let n=o.getAttribute(e);return n==null||n.trim().length===0?t:n}function T(o){let e=[],t=Array.from(o.querySelectorAll(O));for(let n of t){let i=globalThis.getComputedStyle?.(n);(i==null||i.display!=="none"&&i.visibility!=="hidden")&&e.push(n)}return e}function k(o){return o==null?!0:o.trim().length===0}function p(o,e,t){t==null?o.removeAttribute(e):o.setAttribute(e,String(t))}function L(o,e,t){typeof t=="boolean"&&o?.setAttribute(e,String(t))}var f=class{static update(e,t,n){let{anchor:i,floater:s,parent:r}=e,{after:c,getPosition:g,validate:y}=n;function P(){if(!y())return;let H=f.getType(r??i,t),C=g(H,{anchor:i.getBoundingClientRect(),floater:s.getBoundingClientRect(),parent:r?.getBoundingClientRect()});f.setPosition(s,C),c?.(),d(P)}d(P)}static getType(e,t){let n=A(e,"position",t.default);return t.all.includes(n)?n:t.default}static setPosition(e,t){let{left:n,top:i}=t.coordinate;e.getAttribute("position")!==t.type&&e.setAttribute("position",t.type);let s=`matrix(1, 0, 0, 1, ${n}, ${i})`;e.style.transform!==s&&(e.style.inset="0 auto auto 0",e.style.position="fixed",e.style.transform=s,e.hidden&&d(()=>{e.hidden=!1}))}};var v="formal-focus-trap",M=new WeakMap,h=class{static observer(e){for(let t of e){if(t.type!=="attributes")continue;let n=t.target;n.getAttribute(v)==null?m.destroy(n):m.create(n)}}static onKeydown(e){if(e.key!=="Tab")return;let t=e.target,n=w(t,`[${v}]`);n!=null&&(e.preventDefault(),e.stopImmediatePropagation(),h.handle(e,n,t))}static handle(e,t,n){let i=T(t);if(n===t){d(()=>{(i[e.shiftKey?i.length-1:0]??t).focus()});return}let s=i.indexOf(n),r=t;if(s>-1){let c=s+(e.shiftKey?-1:1);c<0?c=i.length-1:c>=i.length&&(c=0),r=i[c]??t}d(()=>{r.focus()})}},m=class{tabIndex;constructor(e){this.tabIndex=e.tabIndex,p(e,"tabindex","-1")}static create(e){M.has(e)||M.set(e,new m(e))}static destroy(e){let t=M.get(e);t!=null&&(p(e,"tabindex",t.tabIndex),M.delete(e))}};(()=>{if(typeof globalThis._formalFocusTrap<"u")return;globalThis._formalFocusTrap=null,new MutationObserver(h.observer).observe(document,{attributeFilter:[v],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),d(()=>{let e=Array.from(document.querySelectorAll(`[${v}]`));for(let t of e)t.setAttribute(v,"")}),document.addEventListener("keydown",h.onKeydown,b.active)})();var S=0,W=["any"].concat(...["above","below"].map(o=>[o,`${o}-left`,`${o}-right`])),l=class{static getPosition(e,t){let n=l.getValue(e,["left","right"],t,!0),i=l.getValue(e,["below","above"],t,!1),s=t.anchor.left===n?"left":"right";if(e!=="any")return{coordinate:{left:n,top:i},type:["above","below"].includes(e)?`${e}-${s}`:e};let r=t.anchor.bottom===i?"below":"above";return{coordinate:{left:n,top:i},type:`${r}-${s}`}}static getValue(e,t,n,i){let{anchor:s,floater:r}=n,c=i?r.width:r.height,g=i?s.left:s.bottom,y=(i?s.right:s.top)-c;return t.some(H=>e.includes(H))?e.includes(t[0]??"_")?g:y:g+c<=(i?globalThis.innerWidth:globalThis.innerHeight)||y<0?g:y}static initialize(e,t,n){n.hidden=!0,k(n.id)&&p(n,"id",k(e.id)?`polite_popover_${S++}`:`${e.id}_content`),p(t,"aria-controls",n.id),L(t,"aria-expanded",!1),p(n,"role","dialog"),p(n,v,""),L(n,"aria-modal",!0),t.addEventListener("click",l.toggle.bind(e),b.passive)}static onClick(e){if(!(this instanceof E)||!this.open)return;let t=a.values.anchors.get(this),n=a.values.floaters.get(this);e.target!==t&&e.target!==n&&!(n?.contains(e.target)??!1)&&l.toggle.call(this,!1)}static onKeydown(e){this instanceof E&&this.open&&e instanceof KeyboardEvent&&e.key==="Escape"&&l.toggle.call(this,!1)}static toggle(e){if(!(this instanceof E))return;let t=a.values.anchors.get(this),n=a.values.floaters.get(this);t!=null&&n!=null&&l.handleToggle(this,t,n,e)}static handleCallbacks(e,t){let n=a.values.click.get(e),i=a.values.keydown.get(e),s=t?"addEventListener":"removeEventListener";n!=null&&document[s]("click",n,b.passive),i!=null&&document[s]("keydown",i,b.active)}static handleToggle(e,t,n,i){let s=typeof i=="boolean"?!i:e.open;if(l.handleCallbacks(e,!s),n.hidden=s,L(t,"aria-expanded",!s),e.dispatchEvent(new Event("toggle")),s){t.focus();return}let r=!1;f.update({anchor:t,floater:n,parent:e},{all:W,default:"below"},{after(){r||(r=!0,d(()=>{(T(n)[0]??n).focus()}))},getPosition:l.getPosition,validate:()=>e.open})}},u=class{static add(e){let t=e.querySelector(":scope > [polite-popover-button]"),n=e.querySelector(":scope > [polite-popover-content]");t==null||n==null||(u.values.anchors?.set(e,t),u.values.floaters?.set(e,n),u.values.click?.set(e,l.onClick.bind(e)),u.values.keydown?.set(e,l.onKeydown.bind(e)))}static remove(e){let t=u.values.floaters.get(e);t!=null&&(t.hidden=!0,e.appendChild(t)),u.values.anchors.delete(e),u.values.floaters.delete(e),u.values.click.delete(e),u.values.keydown.delete(e)}},a=u;x(a,"values",{anchors:new WeakMap,click:new WeakMap,floaters:new WeakMap,keydown:new WeakMap});var E=class extends HTMLElement{get button(){return a.values.anchors.get(this)}get content(){return a.values.floaters.get(this)}get open(){return this.button?.getAttribute("aria-expanded")==="true"}set open(e){l.toggle.call(this,e)}constructor(){super();let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null||!(e instanceof HTMLButtonElement||e instanceof HTMLElement&&e.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(t==null||!(t instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");l.initialize(this,e,t)}connectedCallback(){a.add(this)}disconnectedCallback(){a.remove(this)}toggle(){l.toggle.call(this)}};globalThis.customElements.define("polite-popover",E);
