var A=Object.defineProperty;var O=(i,e,t)=>e in i?A(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var L=(i,e,t)=>(O(i,typeof e!="symbol"?e+"":e,t),t);var h={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},C=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","input","select","textarea","video[controls]"],R=C.map(i=>`${i}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function d(i){return globalThis.requestAnimationFrame?.(i)??globalThis.setTimeout?.(()=>{i(Date.now())},16)}function E(i,e){let t=typeof e=="string";if(t?i.matches(e):e(i))return i;let o=i?.parentElement;for(;o!=null;){if(o===document.body)return;if(t?o.matches(e):e(o))break;o=o.parentElement}return o??void 0}function y(i){let e=[],t=Array.from(i.querySelectorAll(R));for(let o of t){let n=globalThis.getComputedStyle?.(o);(n==null||n.display!=="none"&&n.visibility!=="hidden")&&e.push(o)}return e}function T(i){return i==null?!0:i.trim().length===0}function s(i,e,t){t==null?i.removeAttribute(e):i.setAttribute(e,String(t))}function x(i,e,t){i.setAttribute(e,String(typeof t=="boolean"?t:!1))}var k=["above","above-left","above-right","below","below-left","below-right","horizontal","left","right","vertical"],f=class{static update(e,t){let{anchor:o,floater:n,parent:r}=e;function u(){if(n.hidden){o.insertAdjacentElement("afterend",n);return}let c=f.getPosition((r??o).getAttribute("position")??"",t),H={anchor:o.getBoundingClientRect(),floater:n.getBoundingClientRect()},P=f.getTop(H,c),M=`matrix(1, 0, 0, 1, ${f.getLeft(H,c)}, ${P})`;n.style.position="fixed",n.style.inset="0 auto auto 0",n.style.transform=M,d(u)}document.body.appendChild(n),n.hidden=!1,d(u)}static getLeft(e,t){let{left:o,right:n}=e.anchor,{width:r}=e.floater;switch(t){case"above":case"below":case"vertical":return o+e.anchor.width/2-r/2;case"above-left":case"below-left":return o;case"above-right":case"below-right":return n-r;case"horizontal":return n+r>globalThis.innerWidth?o-r<0?n:o-r:n;case"left":return o-r;case"right":return n;default:return 0}}static getTop(e,t){let{bottom:o,top:n}=e.anchor,{height:r}=e.floater;switch(t){case"above":case"above-left":case"above-right":return n-r;case"below":case"below-left":case"below-right":return o;case"horizontal":case"left":case"right":return n+e.anchor.height/2-r/2;case"vertical":return o+r>globalThis.innerHeight?n-r<0?o:n-r:o;default:return 0}}static getPosition(e,t){if(e==null)return t;let o=e.trim().toLowerCase(),n=k.indexOf(o);return n>-1?k[n]??t:t}};var b="formal-focus-trap",w=new WeakMap,v=class{static observer(e){for(let t of e){if(t.type!=="attributes")continue;let o=t.target;o.getAttribute(b)==null?g.destroy(o):g.create(o)}}static onKeydown(e){if(e.key!=="Tab")return;let t=e.target,o=E(t,`[${b}]`);o!=null&&(e.preventDefault(),e.stopImmediatePropagation(),v.handle(e,o,t))}static handle(e,t,o){let n=y(t);if(o===t){d(()=>{(n[e.shiftKey?n.length-1:0]??t).focus()});return}let r=n.indexOf(o),u=t;if(r>-1){let c=r+(e.shiftKey?-1:1);c<0?c=n.length-1:c>=n.length&&(c=0),u=n[c]??t}d(()=>{u.focus()})}},g=class{tabIndex;constructor(e){this.tabIndex=e.tabIndex,s(e,"tabindex","-1")}static create(e){w.has(e)||w.set(e,new g(e))}static destroy(e){let t=w.get(e);t!=null&&(s(e,"tabindex",t.tabIndex),w.delete(e))}};(()=>{if(typeof globalThis._formalFocusTrap<"u")return;globalThis._formalFocusTrap=null,new MutationObserver(v.observer).observe(document,{attributeFilter:[b],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0}),d(()=>{let e=Array.from(document.querySelectorAll(`[${b}]`));for(let t of e)t.setAttribute(b,"")}),document.addEventListener("keydown",v.onKeydown,h.active)})();var S=0,l=class{static initialize(e,t,o){o.hidden=!0,T(e.id)&&s(e,"id",`polite_popover_${S++}`),T(t.id)&&s(t,"id",`${e.id}_button`),T(o.id)&&s(o,"id",`${e.id}_content`),s(t,"aria-controls",o.id),x(t,"aria-expanded",!1),s(t,"aria-haspopup","dialog"),s(o,b,""),s(o,"role","dialog"),s(o,"aria-modal","false"),t.addEventListener("click",l.toggle.bind(e),h.passive)}static onClick(e){this instanceof m&&this.open&&l.handleGlobalEvent(e,this,e.target)}static onKeydown(e){this instanceof m&&this.open&&e instanceof KeyboardEvent&&e.key==="Escape"&&l.handleGlobalEvent(e,this,document.activeElement)}static toggle(e){let t=this instanceof m?a.elements.get(this):null;t!=null&&l.handleToggle(this,t,e)}static afterToggle(e,t,o){l.handleCallbacks(e,o),o?(y(t.floater)?.[0]??t.floater).focus():t.anchor.focus()}static handleCallbacks(e,t){let o=a.callbacks.get(e);if(o==null)return;let n=t?"addEventListener":"removeEventListener";document[n]("click",o.click,h.passive),document[n]("keydown",o.keydown,h.passive)}static handleGlobalEvent(e,t,o){let n=a.elements.get(t);if(n==null)return;let r=E(o,"[polite-popover-content]");if(r==null){this.handleToggle(t,n,!1);return}e.stopPropagation();let u=Array.from(document.body.children);u.indexOf(r)-u.indexOf(n.floater)<(e instanceof KeyboardEvent?1:0)&&l.handleToggle(t,n,!1)}static handleToggle(e,t,o){let n=typeof o=="boolean"?!o:e.open;x(t.anchor,"aria-expanded",!n),n?(t.floater.hidden=!0,l.afterToggle(e,t,!1)):(f.update({anchor:t.anchor,floater:t.floater,parent:e},"below-left"),d(()=>{l.afterToggle(e,t,!0)})),e.dispatchEvent(new Event("toggle"))}},p=class{static add(e){let t=e.querySelector(":scope > [polite-popover-button]"),o=e.querySelector(":scope > [polite-popover-content]");t==null||o==null||(p.callbacks.set(e,{click:l.onClick.bind(e),keydown:l.onKeydown.bind(e)}),p.elements.set(e,{anchor:t,floater:o}))}static remove(e){let t=p.elements.get(e);t?.floater instanceof HTMLElement&&(t.floater.hidden=!0,t.anchor?.insertAdjacentElement("afterend",t.floater)),p.callbacks.delete(e),p.elements.delete(e)}},a=p;L(a,"callbacks",new WeakMap),L(a,"elements",new WeakMap);var m=class extends HTMLElement{get button(){return a.elements.get(this)?.anchor}get content(){return a.elements.get(this)?.floater}get open(){return this.button?.getAttribute("aria-expanded")==="true"}set open(e){l.toggle.call(this,e)}constructor(){super();let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null||!(e instanceof HTMLButtonElement||e instanceof HTMLElement&&e.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(t==null||!(t instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");l.initialize(this,e,t)}connectedCallback(){a.add(this)}disconnectedCallback(){a.remove(this)}toggle(){l.toggle.call(this)}};globalThis.customElements.define("polite-popover",m);
