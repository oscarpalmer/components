var x=Object.defineProperty;var L=(o,e,t)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var k=(o,e,t)=>(L(o,typeof e!="symbol"?e+"":e,t),t);var h={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},H=["[href]","[tabindex]","button","input","select","textarea"].map(o=>`${o}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function d(o){return globalThis.requestAnimationFrame?.(o)??globalThis.setTimeout?.(()=>{o(Date.now())},16)}function M(o,e,t){let n=o.getAttribute(e);return n==null||n.trim().length===0?t:n}function T(o){let e=[],t=Array.from(o.querySelectorAll(H));for(let n of t){let i=globalThis.getComputedStyle?.(n);(i==null||i.display!=="none"&&i.visibility!=="hidden")&&e.push(n)}return e}function P(o){return o==null?!0:o.trim().length===0}function b(o,e,t){t==null?o.removeAttribute(e):o.setAttribute(e,String(t))}function m(o,e,t){typeof t=="boolean"&&o?.setAttribute(e,String(t))}var f=class{static update(e,t,n){let{anchor:i,floater:l,parent:s}=e,{after:p,getPosition:c,validate:g}=n;function E(){if(!g())return;let y=f.getType(s??i,t),w=c(y,{anchor:i.getBoundingClientRect(),floater:l.getBoundingClientRect(),parent:s?.getBoundingClientRect()});f.setPosition(l,w),p?.(),d(E)}d(E)}static getType(e,t){let n=M(e,"position",t.default);return t.all.includes(n)?n:t.default}static setPosition(e,t){let{left:n,top:i}=t.coordinate;e.getAttribute("position")!==t.type&&e.setAttribute("position",t.type);let l=`matrix(1, 0, 0, 1, ${n}, ${i})`;e.style.transform!==l&&(e.style.inset="0 auto auto 0",e.style.position="fixed",e.style.transform=l,e.hidden&&d(()=>{e.hidden=!1}))}};var A=0,C=["any"].concat(...["above","below"].map(o=>[o,`${o}-left`,`${o}-right`])),a=class{static getPosition(e,t){let n=a.getValue(e,["left","right"],t,!0),i=a.getValue(e,["below","above"],t,!1),l=t.anchor.left===n?"left":"right";if(e!=="any")return{coordinate:{left:n,top:i},type:["above","below"].includes(e)?`${e}-${l}`:e};let s=t.anchor.bottom===i?"below":"above";return{coordinate:{left:n,top:i},type:`${s}-${l}`}}static getValue(e,t,n,i){let{anchor:l,floater:s}=n,p=i?s.width:s.height,c=i?l.left:l.bottom,g=(i?l.right:l.top)-p;return t.some(y=>e.includes(y))?e.includes(t[0]??"_")?c:g:c+p<=(i?globalThis.innerWidth:globalThis.innerHeight)||g<0?c:g}static initialize(e,t,n){n.hidden=!0,P(n.id)&&n.setAttribute("id",P(e.id)?`polite_popover_${A++}`:`${e.id}_content`),b(t,"aria-controls",n.id),m(t,"aria-expanded",!1),b(n,"role","dialog"),b(n,"tabindex","-1"),m(n,"aria-modal",!0),t.addEventListener("click",a.toggle.bind(e),h.passive)}static onClick(e){if(!(this instanceof v)||!this.open)return;let t=r.values.anchors.get(this),n=r.values.floaters.get(this);e.target!==t&&e.target!==n&&!(n?.contains(e.target)??!1)&&a.toggle.call(this,!1)}static onKeydown(e){if(!(this instanceof v)||!this.open||!(e instanceof KeyboardEvent))return;e.key==="Escape"&&a.toggle.call(this,!1);let t=r.values.floaters.get(this);if(e.key!=="Tab"||t==null)return;e.preventDefault();let n=T(t);if(document.activeElement===t){d(()=>{(n[e.shiftKey?n.length-1:0]??t).focus()});return}let i=n.indexOf(document.activeElement),l=t;if(i>-1){let s=i+(e.shiftKey?-1:1);s<0?s=n.length-1:s>=n.length&&(s=0),l=n[s]??t}d(()=>{l.focus()})}static toggle(e){if(!(this instanceof v))return;let t=r.values.anchors.get(this),n=r.values.floaters.get(this);if(t==null||n==null)return;let i=typeof e=="boolean"?!e:this.open,l=r.values.click.get(this),s=r.values.keydown.get(this),p=i?"removeEventListener":"addEventListener";if(l!=null&&document[p]("click",l,h.passive),s!=null&&document[p]("keydown",s,h.active),n.hidden=i,m(t,"aria-expanded",!i),this.dispatchEvent(new Event("toggle")),i){t.focus();return}let c=!1;f.update({anchor:t,floater:n,parent:this},{all:C,default:"below"},{after(){c||(c=!0,d(()=>{(T(n)[0]??n).focus()}))},getPosition:a.getPosition,validate:()=>this.open})}},u=class{static add(e){let t=e.querySelector(":scope > [polite-popover-button]"),n=e.querySelector(":scope > [polite-popover-content]");t==null||n==null||(u.values.anchors?.set(e,t),u.values.floaters?.set(e,n),u.values.click?.set(e,a.onClick.bind(e)),u.values.keydown?.set(e,a.onKeydown.bind(e)))}static remove(e){let t=u.values.floaters.get(e);t!=null&&(t.hidden=!0,e.appendChild(t)),u.values.anchors.delete(e),u.values.floaters.delete(e),u.values.click.delete(e),u.values.keydown.delete(e)}},r=u;k(r,"values",{anchors:new WeakMap,click:new WeakMap,floaters:new WeakMap,keydown:new WeakMap});var v=class extends HTMLElement{get button(){return r.values.anchors.get(this)}get content(){return r.values.floaters.get(this)}get open(){return this.button?.getAttribute("aria-expanded")==="true"}set open(e){a.toggle.call(this,e)}constructor(){super();let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null||!(e instanceof HTMLButtonElement||e instanceof HTMLElement&&e.getAttribute("role")==="button"))throw new Error("<polite-popover> must have a <button>-element (or button-like element) with the attribute 'polite-popover-button'");if(t==null||!(t instanceof HTMLElement))throw new Error("<polite-popover> must have an element with the attribute 'polite-popover-content'");a.initialize(this,e,t)}connectedCallback(){r.add(this)}disconnectedCallback(){r.remove(this)}toggle(){a.toggle.call(this)}};globalThis.customElements.define("polite-popover",v);
