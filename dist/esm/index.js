var C=Object.defineProperty;var P=(o,e,t)=>e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var g=(o,e,t)=>(P(o,typeof e!="symbol"?e+"":e,t),t);var v={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}};function b(o){return requestAnimationFrame?.(o)??setTimeout?.(()=>{o(Date.now())},16)}function H(o,e){let t=o?.parentElement;for(;t!=null;){if(t===document.body)return;if(e(t))break;t=t.parentElement}return t??void 0}var A=["[href]","[tabindex]","button","input","select","textarea"].map(o=>`${o}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function M(o){let e=[],t=Array.from(o.querySelectorAll(A));for(let i of t){let n=window?.getComputedStyle?.(i);(n==null||n.display!=="none"&&n.visibility!=="hidden")&&e.push(i)}return e}function x(){return URL.createObjectURL(new Blob).replace(/^.*\/([\w-]+)$/,"$1").replace(/-/g,"_")}var a=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static onKeydown(e){if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof L))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let i=d.list.children.get(this)??[],n=t.parentElement,l=i.indexOf(n);if(l===-1)return;let s=l+(e.key==="ArrowDown"?1:-1);s<0?s=i.length-1:s>=i.length&&(s=0),i[s]?.querySelector(":scope > summary")?.focus()}static onKeyup(e){if(e.key!=="Escape")return;let{containers:t}=d.details,i=H(document.activeElement,n=>t.has(n)&&(t.get(n)?.open??!0));i instanceof w&&a.onToggle.call(i,!1)}static onToggle(e){if(!(this instanceof w))return;let{buttons:t,containers:i}=d.details,n=i.get(this);n!=null&&(n.open=e??!n.open,n.open||t.get(this)?.focus())}static open(e,t){if(t==null)return;if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let i=t.length>0?t.split(",").filter(n=>n.trim().length>0).map(n=>Number.parseInt(n,10)):[];a.update(e,i)}static update(e,t){if(typeof t>"u")return;let{children:i,observer:n,open:l}=d.list,s=t.filter((c,p,m)=>m.indexOf(c)===p).sort((c,p)=>c-p);if(e.multiple||(s=s.length>0&&s[0]!=null?s.length>1?[s[0]]:s:[]),s.every((c,p)=>e.open[p]===c))return;n.get(e)?.disconnect();let r=i.get(e)??[];for(let c of r)s.includes(r.indexOf(c))!==c.open&&(c.open=!c.open);l.set(e,s),b(()=>{s.length===0?e.removeAttribute("open"):e.setAttribute("open",s.join(",")),b(()=>n.get(e)?.observe(e,E.options))})}},E=class{static callback(e,t){if(t.length===0)return;let{children:i}=d.list,n=t[0],l=Array.from(n?.addedNodes??[]),s=Array.from(n?.removedNodes??[]);if(l.concat(s).some(h=>h.parentElement===e)){i.set(e,a.getChildren(e));return}if(n?.type!=="attributes"||!(n?.target instanceof HTMLDetailsElement))return;let r=n.target,p=(i.get(e)??[]).indexOf(r);if(p===-1)return;let m=[];e.multiple?m=r.open?e.open.concat([p]):e.open.filter(h=>h!==p):m=r.open?[p]:[],a.update(e,m)}};g(E,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var d=class{};g(d,"details",{buttons:new WeakMap,containers:new WeakMap}),g(d,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var w=class extends HTMLElement{close(){a.onToggle.call(this,!1)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e?.querySelector(":scope > summary");d.details.buttons.set(this,t),d.details.containers.set(this,e)}disconnectedCallback(){d.details.buttons.delete(this),d.details.containers.delete(this)}open(){a.onToggle.call(this,!0)}toggle(){a.onToggle.call(this)}},L=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){e?this.setAttribute("multiple",""):this.removeAttribute("multiple")}get open(){return d.list.open.get(this)??[]}set open(e){a.update(this,e)}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multiple":a.open(this,this.getAttribute("open")??void 0);break;case"open":a.open(this,i);break;default:break}}connectedCallback(){let{children:e,observer:t,open:i}=d.list;e.set(this,a.getChildren(this)),i.set(this,[]),t.set(this,new MutationObserver(n=>{E.callback(this,n)})),t.get(this)?.observe(this,E.options),this.addEventListener("keydown",a.onKeydown.bind(this),v.passive),a.open(this,this.getAttribute("open")??void 0)}disconnectedCallback(){let{children:e,observer:t,open:i}=d.list;e.delete(this),t.get(this)?.disconnect(),t.delete(this),i.delete(this)}};addEventListener?.("keyup",a.onKeyup,v.passive);customElements?.define("delicious-details",w);customElements?.define("delicious-details-list",L);var D=["any"].concat(...["above","below"].map(o=>[o,`${o}-left`,`${o}-right`])),u=class{static onClick(e){if(!(this instanceof y))return;let{button:t,content:i}=f.getElements(this);t==null||i==null||t.getAttribute("aria-expanded")!=="true"||e.target!==t&&e.target!==i&&!(i?.contains(e.target)??!1)&&u.toggle.call(this,!1)}static onKeydown(e){if(!(this instanceof y)||!(e instanceof KeyboardEvent))return;let{button:t,content:i}=f.getElements(this);if(t==null||i==null||t.getAttribute("aria-expanded")!=="true"||(e.key==="Escape"&&u.toggle.call(this,!1),e.key!=="Tab"))return;e.preventDefault();let n=M(i);if(document.activeElement===i){b(()=>{(n[e.shiftKey?n.length-1:0]??i).focus()});return}let l=n.indexOf(document.activeElement),s=i;if(l>-1){let r=l+(e.shiftKey?-1:1);r<0?r=n.length-1:r>=n.length&&(r=0),s=n[r]??i}b(()=>{s.focus()})}static setCoordinates(e,t){e.style.inset="0 auto auto 0",e.style.position="fixed",e.style.transform=`translate3d(${t.x}px, ${t.y}px, 0)`}static toggle(e){if(!(this instanceof y))return;let{button:t,content:i}=f.getElements(this);if(t==null||i==null)return;let n=typeof e=="boolean"?!e:t.getAttribute("aria-expanded")==="true",{click:l,keydown:s}=f.getCallbacks(this),r=n?"removeEventListener":"addEventListener";l!=null&&document[r]("click",l,v.passive),s!=null&&document[r]("keydown",s,v.active),n?i.parentElement?.removeChild(i):document.body.appendChild(i),t.setAttribute("aria-expanded",String(!n)),(n?t:M(i)[0]??i).focus(),u.update(this)}static getCoordinates(e,t,i){let{bottom:n,left:l,right:s,top:r}=t.getBoundingClientRect(),{height:c,width:p}=i.getBoundingClientRect(),m=0,h=0;if(e.includes("above"))h=r-c;else if(e.includes("below"))h=n;else{let T=n+c,k=r-c;h=T>window.innerHeight?k<0?n:k:n}if(e.includes("left"))m=l;else if(e.includes("right"))m=s-p;else{let T=l+p,k=s-p;m=T>window.innerWidth?k<0?l:k:l}return{x:m,y:h}}static getPosition(e){let i=e.getAttribute("position")?.trim().toLowerCase();return i!=null&&D.includes(i)?i:"below"}static update(e){let{button:t,content:i}=f.getElements(e);if(t==null||i==null)return;function n(){if(t?.getAttribute("aria-expanded")!=="true"||i==null)return;let l=u.getPosition(e),s=u.getCoordinates(l,t,i);u.setCoordinates(i,s),b(n)}b(n)}},f=class{static getCallbacks(e){return{click:this.values.click.get(e),keydown:this.values.keydown.get(e)}}static getElements(e){return{button:this.values.buttons.get(e),content:this.values.content.get(e)}}static remove(e){this.values.buttons.delete(e),this.values.click.delete(e),this.values.content.delete(e),this.values.keydown.delete(e)}static setCallbacks(e){this.values.click?.set(e,u.onClick.bind(e)),this.values.keydown?.set(e,u.onKeydown.bind(e))}static setElements(e,t,i){this.values.buttons?.set(e,t),this.values.content?.set(e,i)}};g(f,"values",{buttons:new WeakMap,click:new WeakMap,content:new WeakMap,keydown:new WeakMap});var y=class extends HTMLElement{close(){u.toggle.call(this,!1)}connectedCallback(){let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null)throw new Error("a");if(!(e instanceof HTMLButtonElement)&&e.getAttribute("role")!=="button")throw new Error("b");if(t==null)throw new Error("c");t.parentElement?.removeChild(t),t.id||t.setAttribute("id",x()),u.setCoordinates(t,{x:-1e5,y:-1e5}),e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","false"),t.setAttribute("tabindex","-1"),f.setElements(this,e,t),f.setCallbacks(this),e.addEventListener("click",u.toggle.bind(this),v.passive)}disconnectedCallback(){f.remove(this)}open(){u.toggle.call(this,!0)}toggle(){u.toggle.call(this)}};customElements?.define("polite-popover",y);
