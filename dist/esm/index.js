var D=Object.defineProperty;var k=(r,e,t)=>e in r?D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>(k(r,typeof e!="symbol"?e+"":e,t),t);var E={capture:!1,passive:!0},p=class{static escape(e){if(e.key!=="Escape")return;let t=document.activeElement?.parentElement;for(;t!=null;){if(t===document.body){t=null;break}if(t instanceof b&&(l.details.containers.get(t)?.open??!0))break;t=t.parentElement}t!=null&&p.toggle(t,!1)}static toggle(e,t){let{buttons:s,containers:i}=l.details,u=i.get(e);u!=null&&(u.open=t??!u.open,u.open||s.get(e)?.focus())}},c=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static open(e,t){if(t==null)return;if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let s=t.length>0?t.split(",").filter(i=>i.trim().length>0).map(i=>Number.parseInt(i,10)):[];this.update(e,s)}static traverse(e,t){if(t.isComposing||t.key!=="ArrowDown"&&t.key!=="ArrowUp")return;let{target:s}=t;if(!(s instanceof HTMLElement))return;let i=l.list.children.get(e)??[],u=s.parentElement,n=i.indexOf(u);if(n===-1)return;let o=n+(t.key==="ArrowDown"?1:-1);o<0?o=i.length-1:o>=i.length&&(o=0),i[o]?.querySelector(":scope > summary")?.focus()}static update(e,t){if(typeof t>"u")return;let{children:s,observer:i,open:u}=l.list,n=t.filter((a,d,f)=>f.indexOf(a)===d).sort((a,d)=>a-d);if(e.multiple||(n=n.length>0&&n[0]!=null?n.length>1?[n[0]]:n:[]),n.every((a,d)=>e.open[d]===a))return;i.get(e)?.disconnect();let o=s.get(e)??[];for(let a of o)n.includes(o.indexOf(a))!==a.open&&(a.open=!a.open);u.set(e,n),y(()=>{n.length===0?e.removeAttribute("open"):e.setAttribute("open",n.join(",")),y(()=>i.get(e)?.observe(e,m.options))})}},m=class{static callback(e,t){if(t.length===0)return;let{children:s}=l.list,i=t[0],u=Array.from(i?.addedNodes??[]),n=Array.from(i?.removedNodes??[]);if(u.concat(n).some(g=>g.parentElement===e)){s.set(e,c.getChildren(e));return}if(i?.type!=="attributes"||!(i?.target instanceof HTMLDetailsElement))return;let o=i.target,d=(s.get(e)??[]).indexOf(o);if(d===-1)return;let f=[];e.multiple?f=o.open?e.open.concat([d]):e.open.filter(g=>g!==d):f=o.open?[d]:[],c.update(e,f)}};h(m,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var l=class{};h(l,"details",{buttons:new WeakMap,containers:new WeakMap}),h(l,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});function y(r){return requestAnimationFrame?.(r)??setTimeout?.(r,16)}var b=class extends HTMLElement{close(){p.toggle(this,!1)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e?.querySelector(":scope > summary");l.details.buttons.set(this,t),l.details.containers.set(this,e)}disconnectedCallback(){l.details.buttons.delete(this),l.details.containers.delete(this)}open(){p.toggle(this,!0)}toggle(){p.toggle(this)}},v=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){e?this.setAttribute("multiple",""):this.removeAttribute("multiple")}get open(){return l.list.open.get(this)??[]}set open(e){c.update(this,e)}attributeChangedCallback(e,t,s){if(t!==s)switch(e){case"multiple":c.open(this,this.getAttribute("open")??void 0);break;case"open":c.open(this,s);break;default:break}}connectedCallback(){let{children:e,observer:t,open:s}=l.list;e.set(this,c.getChildren(this)),s.set(this,[]),t.set(this,new MutationObserver(i=>{m.callback(this,i)})),t.get(this)?.observe(this,m.options),this.addEventListener("keydown",i=>{c.traverse(this,i)},E),c.open(this,this.getAttribute("open")??void 0)}disconnectedCallback(){let{children:e,observer:t,open:s}=l.list;e.delete(this),t.get(this)?.disconnect(),t.delete(this),s.delete(this)}};addEventListener?.("keyup",p.escape,E);customElements?.define("delicious-details",b);customElements?.define("delicious-details-list",v);
//# sourceMappingURL=index.js.map
