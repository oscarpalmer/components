{
  "version": 3,
  "sources": ["../../src/details.ts"],
  "sourcesContent": ["const keyEventOptions = {capture: false, passive: true};\n\nclass DetailsHandler {\n\tstatic escape(event: KeyboardEvent): void {\n\t\tif (event.key !== 'Escape') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet parent = document.activeElement?.parentElement;\n\n\t\twhile (parent != null) {\n\t\t\tif (parent === document.body) {\n\t\t\t\tparent = null;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parent instanceof DeliciousDetails && (Store.details.containers.get(parent)?.open ?? true)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tparent = parent.parentElement;\n\t\t}\n\n\t\tif (parent != null) {\n\t\t\tDetailsHandler.toggle(parent, false);\n\t\t}\n\t}\n\n\tstatic toggle(component: DeliciousDetails, open?: boolean): void {\n\t\tconst {buttons, containers} = Store.details;\n\n\t\tconst container = containers.get(component);\n\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tcontainer.open = open ?? !container.open;\n\n\t\tif (!container.open) {\n\t\t\tbuttons.get(component)?.focus();\n\t\t}\n\t}\n}\n\nclass ListHandler {\n\tstatic getChildren(component: DeliciousDetailsList): HTMLDetailsElement[] {\n\t\treturn Array.from(component.querySelectorAll(':scope > delicious-details > details, :scope > details'));\n\t}\n\n\tstatic open(component: DeliciousDetailsList, value: string | undefined): void {\n\t\tif (value == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (value.length > 0 && !/^[\\s\\d,]+$/.test(value)) {\n\t\t\tthrow new Error('The \\'selected\\'-attribute of a \\'delicious-details-list\\'-element must be a comma-separated string of numbers, e.g. \\'\\', \\'0\\' or \\'0,1,2\\'');\n\t\t}\n\n\t\tconst parts = value.length > 0\n\t\t\t? value\n\t\t\t\t.split(',')\n\t\t\t\t.filter(index => index.trim().length > 0)\n\t\t\t\t.map(index => Number.parseInt(index, 10))\n\t\t\t: [];\n\n\t\tthis.update(component, parts);\n\t}\n\n\tstatic traverse(component: DeliciousDetailsList, event: KeyboardEvent): void {\n\t\tif (event.isComposing || (event.key !== 'ArrowDown' && event.key !== 'ArrowUp')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {target} = event;\n\n\t\tif (!(target instanceof HTMLElement)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst children = Store.list.children.get(component) ?? [];\n\t\tconst parent = target.parentElement;\n\t\tconst index = children.indexOf(parent as HTMLDetailsElement);\n\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet position = index + (event.key === 'ArrowDown' ? 1 : -1);\n\n\t\tif (position < 0) {\n\t\t\tposition = children.length - 1;\n\t\t} else if (position >= children.length) {\n\t\t\tposition = 0;\n\t\t}\n\n\t\tconst details = children[position];\n\t\tconst summary = details?.querySelector(':scope > summary');\n\n\t\t(summary as HTMLButtonElement)?.focus();\n\t}\n\n\tstatic update(component: DeliciousDetailsList, selection: number[] | undefined): void {\n\t\tif (typeof selection === 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tlet sorted = selection\n\t\t\t.filter((v, i, a) => a.indexOf(v) === i)\n\t\t\t.sort((f, s) => f - s);\n\n\t\tif (!component.multiple) {\n\t\t\tsorted = sorted.length > 0 && sorted[0] != null\n\t\t\t\t? sorted.length > 1\n\t\t\t\t\t? [sorted[0]]\n\t\t\t\t\t: sorted\n\t\t\t\t: [];\n\t\t}\n\n\t\tif (sorted.every((v, i) => component.open[i] === v)) {\n\t\t\treturn;\n\t\t}\n\n\t\tobserver.get(component)?.disconnect();\n\n\t\tconst elements = children.get(component) ?? [];\n\n\t\tfor (const element of elements) {\n\t\t\tif (sorted.includes(elements.indexOf(element)) !== element.open) {\n\t\t\t\telement.open = !element.open;\n\t\t\t}\n\t\t}\n\n\t\topen.set(component, sorted);\n\n\t\tdelay(() => {\n\t\t\tif (sorted.length === 0) {\n\t\t\t\tcomponent.removeAttribute('open');\n\t\t\t} else {\n\t\t\t\tcomponent.setAttribute('open', sorted.join(','));\n\t\t\t}\n\n\t\t\tdelay(() => observer.get(component)?.observe(component, Observer.options));\n\t\t});\n\t}\n}\n\nclass Observer {\n\tstatic readonly options: MutationObserverInit = {\n\t\tattributeFilter: ['open'],\n\t\tattributes: true,\n\t\tchildList: true,\n\t\tsubtree: true,\n\t};\n\n\tstatic callback(component: DeliciousDetailsList, records: MutationRecord[]): void {\n\t\tif (records.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {children} = Store.list;\n\t\tconst record = records[0];\n\t\tconst added = Array.from(record?.addedNodes ?? []);\n\t\tconst removed = Array.from(record?.removedNodes ?? []);\n\n\t\tif (added.concat(removed).some(element => element.parentElement === component)) {\n\t\t\tchildren.set(component, ListHandler.getChildren(component));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (record?.type !== 'attributes' || !(record?.target instanceof HTMLDetailsElement)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = record.target;\n\t\tconst elements = children.get(component) ?? [];\n\t\tconst index = elements.indexOf(element);\n\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet selection: number[] = [];\n\n\t\tif (component.multiple) {\n\t\t\tselection = element.open\n\t\t\t\t? component.open.concat([index])\n\t\t\t\t: component.open.filter(v => v !== index);\n\t\t} else {\n\t\t\tselection = element.open ? [index] : [];\n\t\t}\n\n\t\tListHandler.update(component, selection);\n\t}\n}\n\nclass Store {\n\tstatic readonly details = {\n\t\tbuttons: new WeakMap<DeliciousDetails, HTMLButtonElement>(),\n\t\tcontainers: new WeakMap<DeliciousDetails, HTMLDetailsElement>(),\n\t};\n\n\tstatic readonly list = {\n\t\tchildren: new WeakMap<DeliciousDetailsList, HTMLDetailsElement[]>(),\n\t\tobserver: new WeakMap<DeliciousDetailsList, MutationObserver>(),\n\t\topen: new WeakMap<DeliciousDetailsList, number[]>(),\n\t};\n}\n\nfunction delay(callback: () => void): number {\n\treturn requestAnimationFrame?.(callback) ?? setTimeout?.(callback, 16);\n}\n\nclass DeliciousDetails extends HTMLElement {\n\tclose(): void {\n\t\tDetailsHandler.toggle(this, false);\n\t}\n\n\tconnectedCallback(): void {\n\t\tconst details = this.querySelector(':scope > details')!;\n\t\tconst summary = details?.querySelector(':scope > summary');\n\n\t\tStore.details.buttons.set(this, summary as HTMLButtonElement);\n\t\tStore.details.containers.set(this, details as HTMLDetailsElement);\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tStore.details.buttons.delete(this);\n\t\tStore.details.containers.delete(this);\n\t}\n\n\topen(): void {\n\t\tDetailsHandler.toggle(this, true);\n\t}\n\n\ttoggle(): void {\n\t\tDetailsHandler.toggle(this);\n\t}\n}\n\nclass DeliciousDetailsList extends HTMLElement {\n\tstatic get observedAttributes() {\n\t\treturn ['multiple', 'open'];\n\t}\n\n\tget multiple(): boolean {\n\t\treturn this.getAttribute('multiple') != null;\n\t}\n\n\tset multiple(multiple: boolean) {\n\t\tif (multiple) {\n\t\t\tthis.setAttribute('multiple', '');\n\t\t} else {\n\t\t\tthis.removeAttribute('multiple');\n\t\t}\n\t}\n\n\tget open(): number[] {\n\t\treturn Store.list.open.get(this) ?? [];\n\t}\n\n\tset open(indices: number[]) {\n\t\tListHandler.update(this, indices);\n\t}\n\n\tattributeChangedCallback(name: string, oldValue: string, newValue: string): void {\n\t\tif (oldValue === newValue) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (name) {\n\t\t\tcase 'multiple':\n\t\t\t\tListHandler.open(this, this.getAttribute('open') ?? undefined);\n\t\t\t\tbreak;\n\t\t\tcase 'open':\n\t\t\t\tListHandler.open(this, newValue);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconnectedCallback(): void {\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tchildren.set(this, ListHandler.getChildren(this));\n\t\topen.set(this, []);\n\n\t\tobserver.set(this, new MutationObserver(records => {\n\t\t\tObserver.callback(this, records);\n\t\t}));\n\n\t\tobserver.get(this)?.observe(this, Observer.options);\n\n\t\tthis.addEventListener('keydown', event => {\n\t\t\tListHandler.traverse(this, event);\n\t\t}, keyEventOptions);\n\n\t\tListHandler.open(this, this.getAttribute('open') ?? undefined);\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tchildren.delete(this);\n\t\tobserver.get(this)?.disconnect();\n\t\tobserver.delete(this);\n\t\topen.delete(this);\n\t}\n}\n\naddEventListener?.('keyup', DetailsHandler.escape, keyEventOptions);\n\ncustomElements?.define('delicious-details', DeliciousDetails);\ncustomElements?.define('delicious-details-list', DeliciousDetailsList);\n"],
  "mappings": "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",
  "names": ["keyEventOptions", "DetailsHandler", "event", "parent", "DeliciousDetails", "Store", "component", "open", "buttons", "containers", "container", "ListHandler", "value", "parts", "index", "target", "children", "position", "selection", "observer", "sorted", "v", "i", "a", "f", "s", "elements", "element", "delay", "Observer", "records", "record", "added", "removed", "__publicField", "callback", "details", "summary", "DeliciousDetailsList", "multiple", "indices", "name", "oldValue", "newValue"]
}
