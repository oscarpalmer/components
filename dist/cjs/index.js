"use strict";var M=Object.defineProperty;var A=(a,e,t)=>e in a?M(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var m=(a,e,t)=>(A(a,typeof e!="symbol"?e+"":e,t),t);var L={capture:!1,passive:!0},f=class{static escape(e){var n,i,r;if(e.key!=="Escape")return;let t=(n=document.activeElement)==null?void 0:n.parentElement;for(;t!=null;){if(t===document.body){t=null;break}if(t instanceof v&&((r=(i=o.details.containers.get(t))==null?void 0:i.open)!=null?r:!0))break;t=t.parentElement}t!=null&&f.toggle(t,!1)}static toggle(e,t){var s;let{buttons:n,containers:i}=o.details,r=i.get(e);r!=null&&(r.open=t!=null?t:!r.open,r.open||(s=n.get(e))==null||s.focus())}},c=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static open(e,t){if(t==null)return;if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let n=t.length>0?t.split(",").filter(i=>i.trim().length>0).map(i=>Number.parseInt(i,10)):[];this.update(e,n)}static traverse(e,t){var l;if(t.isComposing||t.key!=="ArrowDown"&&t.key!=="ArrowUp")return;let{target:n}=t;if(!(n instanceof HTMLElement))return;let i=(l=o.list.children.get(e))!=null?l:[],r=n.parentElement,s=i.indexOf(r);if(s===-1)return;let u=s+(t.key==="ArrowDown"?1:-1);u<0?u=i.length-1:u>=i.length&&(u=0);let h=i[u],d=h==null?void 0:h.querySelector(":scope > summary");d==null||d.focus()}static update(e,t){var h,d;if(typeof t=="undefined")return;let{children:n,observer:i,open:r}=o.list,s=t.filter((l,p,g)=>g.indexOf(l)===p).sort((l,p)=>l-p);if(e.multiple||(s=s.length>0&&s[0]!=null?s.length>1?[s[0]]:s:[]),s.every((l,p)=>e.open[p]===l))return;(h=i.get(e))==null||h.disconnect();let u=(d=n.get(e))!=null?d:[];for(let l of u)s.includes(u.indexOf(l))!==l.open&&(l.open=!l.open);r.set(e,s),k(()=>{s.length===0?e.removeAttribute("open"):e.setAttribute("open",s.join(",")),k(()=>{var l;return(l=i.get(e))==null?void 0:l.observe(e,b.options)})})}},b=class{static callback(e,t){var p,g,D;if(t.length===0)return;let{children:n}=o.list,i=t[0],r=Array.from((p=i==null?void 0:i.addedNodes)!=null?p:[]),s=Array.from((g=i==null?void 0:i.removedNodes)!=null?g:[]);if(r.concat(s).some(y=>y.parentElement===e)){n.set(e,c.getChildren(e));return}if((i==null?void 0:i.type)!=="attributes"||!((i==null?void 0:i.target)instanceof HTMLDetailsElement))return;let u=i.target,d=((D=n.get(e))!=null?D:[]).indexOf(u);if(d===-1)return;let l=[];e.multiple?l=u.open?e.open.concat([d]):e.open.filter(y=>y!==d):l=u.open?[d]:[],c.update(e,l)}};m(b,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var o=class{};m(o,"details",{buttons:new WeakMap,containers:new WeakMap}),m(o,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});function k(a){var e;return(e=requestAnimationFrame==null?void 0:requestAnimationFrame(a))!=null?e:setTimeout==null?void 0:setTimeout(a,16)}var v=class extends HTMLElement{close(){f.toggle(this,!1)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e==null?void 0:e.querySelector(":scope > summary");o.details.buttons.set(this,t),o.details.containers.set(this,e)}disconnectedCallback(){o.details.buttons.delete(this),o.details.containers.delete(this)}open(){f.toggle(this,!0)}toggle(){f.toggle(this)}},E=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){e?this.setAttribute("multiple",""):this.removeAttribute("multiple")}get open(){var e;return(e=o.list.open.get(this))!=null?e:[]}set open(e){c.update(this,e)}attributeChangedCallback(e,t,n){var i;if(t!==n)switch(e){case"multiple":c.open(this,(i=this.getAttribute("open"))!=null?i:void 0);break;case"open":c.open(this,n);break;default:break}}connectedCallback(){var i,r;let{children:e,observer:t,open:n}=o.list;e.set(this,c.getChildren(this)),n.set(this,[]),t.set(this,new MutationObserver(s=>{b.callback(this,s)})),(i=t.get(this))==null||i.observe(this,b.options),this.addEventListener("keydown",s=>{c.traverse(this,s)},L),c.open(this,(r=this.getAttribute("open"))!=null?r:void 0)}disconnectedCallback(){var i;let{children:e,observer:t,open:n}=o.list;e.delete(this),(i=t.get(this))==null||i.disconnect(),t.delete(this),n.delete(this)}};addEventListener==null||addEventListener("keyup",f.escape,L);customElements==null||customElements.define("delicious-details",v);customElements==null||customElements.define("delicious-details-list",E);
//# sourceMappingURL=index.js.map
