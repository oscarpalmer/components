"use strict";var P=Object.defineProperty;var A=(o,e,t)=>e in o?P(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var y=(o,e,t)=>(A(o,typeof e!="symbol"?e+"":e,t),t);var E={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}};function g(o){var e;return(e=requestAnimationFrame==null?void 0:requestAnimationFrame(o))!=null?e:setTimeout==null?void 0:setTimeout(()=>{o(Date.now())},16)}function x(o,e){let t=o==null?void 0:o.parentElement;for(;t!=null;){if(t===document.body)return;if(e(t))break;t=t.parentElement}return t!=null?t:void 0}var D=["[href]","[tabindex]","button","input","select","textarea"].map(o=>`${o}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function H(o){var n;let e=[],t=Array.from(o.querySelectorAll(D));for(let i of t){let s=(n=window==null?void 0:window.getComputedStyle)==null?void 0:n.call(window,i);(s==null||s.display!=="none"&&s.visibility!=="hidden")&&e.push(i)}return e}function C(){return URL.createObjectURL(new Blob).replace(/^.*\/([\w-]+)$/,"$1").replace(/-/g,"_")}var d=class{static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static onKeydown(e){var u;if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof T))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let n=(u=p.list.children.get(this))!=null?u:[],i=t.parentElement,s=n.indexOf(i);if(s===-1)return;let l=s+(e.key==="ArrowDown"?1:-1);l<0?l=n.length-1:l>=n.length&&(l=0);let c=n[l],a=c==null?void 0:c.querySelector(":scope > summary");a==null||a.focus()}static onKeyup(e){if(e.key!=="Escape")return;let{containers:t}=p.details,n=x(document.activeElement,i=>{var s,l;return t.has(i)&&((l=(s=t.get(i))==null?void 0:s.open)!=null?l:!0)});n instanceof L&&d.onToggle.call(n,!1)}static onToggle(e){var s;if(!(this instanceof L))return;let{buttons:t,containers:n}=p.details,i=n.get(this);i!=null&&(i.open=e!=null?e:!i.open,i.open||(s=t.get(this))==null||s.focus())}static open(e,t){if(t==null)return;if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let n=t.length>0?t.split(",").filter(i=>i.trim().length>0).map(i=>Number.parseInt(i,10)):[];d.update(e,n)}static update(e,t){var a,u;if(typeof t=="undefined")return;let{children:n,observer:i,open:s}=p.list,l=t.filter((r,h,b)=>b.indexOf(r)===h).sort((r,h)=>r-h);if(e.multiple||(l=l.length>0&&l[0]!=null?l.length>1?[l[0]]:l:[]),l.every((r,h)=>e.open[h]===r))return;(a=i.get(e))==null||a.disconnect();let c=(u=n.get(e))!=null?u:[];for(let r of c)l.includes(c.indexOf(r))!==r.open&&(r.open=!r.open);s.set(e,l),g(()=>{l.length===0?e.removeAttribute("open"):e.setAttribute("open",l.join(",")),g(()=>{var r;return(r=i.get(e))==null?void 0:r.observe(e,k.options)})})}},k=class{static callback(e,t){var h,b,v;if(t.length===0)return;let{children:n}=p.list,i=t[0],s=Array.from((h=i==null?void 0:i.addedNodes)!=null?h:[]),l=Array.from((b=i==null?void 0:i.removedNodes)!=null?b:[]);if(s.concat(l).some(M=>M.parentElement===e)){n.set(e,d.getChildren(e));return}if((i==null?void 0:i.type)!=="attributes"||!((i==null?void 0:i.target)instanceof HTMLDetailsElement))return;let c=i.target,u=((v=n.get(e))!=null?v:[]).indexOf(c);if(u===-1)return;let r=[];e.multiple?r=c.open?e.open.concat([u]):e.open.filter(M=>M!==u):r=c.open?[u]:[],d.update(e,r)}};y(k,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var p=class{};y(p,"details",{buttons:new WeakMap,containers:new WeakMap}),y(p,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var L=class extends HTMLElement{close(){d.onToggle.call(this,!1)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e==null?void 0:e.querySelector(":scope > summary");p.details.buttons.set(this,t),p.details.containers.set(this,e)}disconnectedCallback(){p.details.buttons.delete(this),p.details.containers.delete(this)}open(){d.onToggle.call(this,!0)}toggle(){d.onToggle.call(this)}},T=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){e?this.setAttribute("multiple",""):this.removeAttribute("multiple")}get open(){var e;return(e=p.list.open.get(this))!=null?e:[]}set open(e){d.update(this,e)}attributeChangedCallback(e,t,n){var i;if(t!==n)switch(e){case"multiple":d.open(this,(i=this.getAttribute("open"))!=null?i:void 0);break;case"open":d.open(this,n);break;default:break}}connectedCallback(){var i,s;let{children:e,observer:t,open:n}=p.list;e.set(this,d.getChildren(this)),n.set(this,[]),t.set(this,new MutationObserver(l=>{k.callback(this,l)})),(i=t.get(this))==null||i.observe(this,k.options),this.addEventListener("keydown",d.onKeydown.bind(this),E.passive),d.open(this,(s=this.getAttribute("open"))!=null?s:void 0)}disconnectedCallback(){var i;let{children:e,observer:t,open:n}=p.list;e.delete(this),(i=t.get(this))==null||i.disconnect(),t.delete(this),n.delete(this)}};addEventListener==null||addEventListener("keyup",d.onKeyup,E.passive);customElements==null||customElements.define("delicious-details",L);customElements==null||customElements.define("delicious-details-list",T);var W=["any"].concat(...["above","below"].map(o=>[o,`${o}-left`,`${o}-right`])),f=class{static onClick(e){var i;if(!(this instanceof w))return;let{button:t,content:n}=m.getElements(this);t==null||n==null||t.getAttribute("aria-expanded")!=="true"||e.target!==t&&e.target!==n&&!((i=n==null?void 0:n.contains(e.target))!=null&&i)&&f.toggle.call(this,!1)}static onKeydown(e){var c;if(!(this instanceof w)||!(e instanceof KeyboardEvent))return;let{button:t,content:n}=m.getElements(this);if(t==null||n==null||t.getAttribute("aria-expanded")!=="true"||(e.key==="Escape"&&f.toggle.call(this,!1),e.key!=="Tab"))return;e.preventDefault();let i=H(n);if(document.activeElement===n){g(()=>{var a;((a=i[e.shiftKey?i.length-1:0])!=null?a:n).focus()});return}let s=i.indexOf(document.activeElement),l=n;if(s>-1){let a=s+(e.shiftKey?-1:1);a<0?a=i.length-1:a>=i.length&&(a=0),l=(c=i[a])!=null?c:n}g(()=>{l.focus()})}static setCoordinates(e,t){e.style.inset="0 auto auto 0",e.style.position="fixed",e.style.transform=`translate3d(${t.x}px, ${t.y}px, 0)`}static toggle(e){var a,u;if(!(this instanceof w))return;let{button:t,content:n}=m.getElements(this);if(t==null||n==null)return;let i=typeof e=="boolean"?!e:t.getAttribute("aria-expanded")==="true",{click:s,keydown:l}=m.getCallbacks(this),c=i?"removeEventListener":"addEventListener";s!=null&&document[c]("click",s,E.passive),l!=null&&document[c]("keydown",l,E.active),i?(a=n.parentElement)==null||a.removeChild(n):document.body.appendChild(n),t.setAttribute("aria-expanded",String(!i)),(i?t:(u=H(n)[0])!=null?u:n).focus(),f.update(this)}static getCoordinates(e,t,n){let{bottom:i,left:s,right:l,top:c}=t.getBoundingClientRect(),{height:a,width:u}=n.getBoundingClientRect(),r=0,h=0;if(e.includes("above"))h=c-a;else if(e.includes("below"))h=i;else{let b=i+a,v=c-a;h=b>window.innerHeight?v<0?i:v:i}if(e.includes("left"))r=s;else if(e.includes("right"))r=l-u;else{let b=s+u,v=l-u;r=b>window.innerWidth?v<0?s:v:s}return{x:r,y:h}}static getPosition(e){let t=e.getAttribute("position"),n=t==null?void 0:t.trim().toLowerCase();return n!=null&&W.includes(n)?n:"below"}static update(e){let{button:t,content:n}=m.getElements(e);if(t==null||n==null)return;function i(){if((t==null?void 0:t.getAttribute("aria-expanded"))!=="true"||n==null)return;let s=f.getPosition(e),l=f.getCoordinates(s,t,n);f.setCoordinates(n,l),g(i)}g(i)}},m=class{static getCallbacks(e){return{click:this.values.click.get(e),keydown:this.values.keydown.get(e)}}static getElements(e){return{button:this.values.buttons.get(e),content:this.values.content.get(e)}}static remove(e){this.values.buttons.delete(e),this.values.click.delete(e),this.values.content.delete(e),this.values.keydown.delete(e)}static setCallbacks(e){var t,n;(t=this.values.click)==null||t.set(e,f.onClick.bind(e)),(n=this.values.keydown)==null||n.set(e,f.onKeydown.bind(e))}static setElements(e,t,n){var i,s;(i=this.values.buttons)==null||i.set(e,t),(s=this.values.content)==null||s.set(e,n)}};y(m,"values",{buttons:new WeakMap,click:new WeakMap,content:new WeakMap,keydown:new WeakMap});var w=class extends HTMLElement{close(){f.toggle.call(this,!1)}connectedCallback(){var n;let e=this.querySelector(":scope > [polite-popover-button]"),t=this.querySelector(":scope > [polite-popover-content]");if(e==null)throw new Error("a");if(!(e instanceof HTMLButtonElement)&&e.getAttribute("role")!=="button")throw new Error("b");if(t==null)throw new Error("c");(n=t.parentElement)==null||n.removeChild(t),t.id||t.setAttribute("id",C()),f.setCoordinates(t,{x:-1e5,y:-1e5}),e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","false"),t.setAttribute("tabindex","-1"),m.setElements(this,e,t),m.setCallbacks(this),e.addEventListener("click",f.toggle.bind(this),E.passive)}disconnectedCallback(){m.remove(this)}open(){f.toggle.call(this,!0)}toggle(){f.toggle.call(this)}};customElements==null||customElements.define("polite-popover",w);
