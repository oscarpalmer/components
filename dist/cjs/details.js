"use strict";var k=Object.defineProperty;var H=(n,e,t)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var y=(n,e,t)=>(H(n,typeof e!="symbol"?e+"":e,t),t);var T={active:{capture:!1,passive:!1},passive:{capture:!1,passive:!0}},x=['[contenteditable]:not([contenteditable="false"])',"[href]","[tabindex]:not(slot)","audio[controls]","button","details","details[open] > summary","input","select","textarea","video[controls]"],C=x.map(n=>`${n}:not([disabled]):not([hidden]):not([tabindex="-1"])`).join(",");function v(n){var e,t,i;return(i=(e=globalThis.requestAnimationFrame)==null?void 0:e.call(globalThis,n))!=null?i:(t=globalThis.setTimeout)==null?void 0:t.call(globalThis,()=>{n(Date.now())},16)}function M(n,e){let t=typeof e=="string";if(t?n.matches(e):e(n))return n;let i=n==null?void 0:n.parentElement;for(;i!=null;){if(i===document.body)return;if(t?i.matches(e):e(i))break;i=i.parentElement}return i!=null?i:void 0}function D(n,e,t){let i=n.getAttribute(e);return i==null||i.trim().length===0?t:i}function w(n,e,t){t==null?n.removeAttribute(e):n.setAttribute(e,String(t))}var o=class{static destroyList(e){var r;let{children:t,observer:i,open:s}=a.list;t.delete(e),s.delete(e),(r=i.get(e))==null||r.disconnect(),i.delete(e)}static getChildren(e){return Array.from(e.querySelectorAll(":scope > delicious-details > details, :scope > details"))}static initializeList(e){var r;let{children:t,observer:i,open:s}=a.list;t.set(e,o.getChildren(e)),s.set(e,[]),i.set(e,new MutationObserver(l=>{b.callback(e,l)})),(r=i.get(e))==null||r.observe(e,b.options),o.open(e,D(e,"open",""))}static onGlobalKeydown(e){if(e.key!=="Escape")return;let{containers:t}=a.details,i=M(document.activeElement,s=>{var r,l;return t.has(s)&&((l=(r=t.get(s))==null?void 0:r.open)!=null?l:!0)});i instanceof h&&o.onToggle.call(i,!1)}static onLocalKeydown(e){var c;if(e.isComposing||e.key!=="ArrowDown"&&e.key!=="ArrowUp"||!(this instanceof E))return;let{target:t}=e;if(!(t instanceof HTMLElement))return;let i=(c=a.list.children.get(this))!=null?c:[],s=t.parentElement,r=i.indexOf(s);if(r===-1)return;let l=r+(e.key==="ArrowDown"?1:-1);l<0?l=i.length-1:l>=i.length&&(l=0);let d=i[l],g=d==null?void 0:d.querySelector(":scope > summary");g==null||g.focus()}static onToggle(e){var r;if(!(this instanceof h))return;let{buttons:t,containers:i}=a.details,s=i.get(this);s!=null&&(s.open=e!=null?e:!s.open,s.open||(r=t.get(this))==null||r.focus())}static open(e,t){if(t==null){o.update(e,[]);return}if(t.length>0&&!/^[\s\d,]+$/.test(t))throw new Error("The 'selected'-attribute of a 'delicious-details-list'-element must be a comma-separated string of numbers, e.g. '', '0' or '0,1,2'");let i=t.length>0?t.split(",").filter(s=>s.trim().length>0).map(s=>Number.parseInt(s,10)):[];o.update(e,i)}static update(e,t){var c,p;if(typeof t=="undefined")return;let{children:i,observer:s,open:r}=a.list,l=t.filter((u,f,m)=>m.indexOf(u)===f).sort((u,f)=>u-f);e.multiple||(l=l.length>0&&l[0]!=null?l.length>1?[l[0]]:l:[]);let d=e.open;if(l.length===d.length&&l.every((u,f)=>d[f]===u))return;(c=s.get(e))==null||c.disconnect();let g=(p=i.get(e))!=null?p:[];for(let u of g)l.includes(g.indexOf(u))!==u.open&&(u.open=!u.open);v(()=>{r.set(e,l),w(e,"open",l.length===0?null:l),e.dispatchEvent(new Event("toggle")),v(()=>{var u;return(u=s.get(e))==null?void 0:u.observe(e,b.options)})})}},b=class{static callback(e,t){var u,f,m;if(t.length===0)return;let{children:i}=a.list,s=t[0],r=Array.from((u=s==null?void 0:s.addedNodes)!=null?u:[]),l=Array.from((f=s==null?void 0:s.removedNodes)!=null?f:[]);if(r.concat(l).some(L=>L.parentElement===e)){i.set(e,o.getChildren(e));return}if((s==null?void 0:s.type)!=="attributes"||!((s==null?void 0:s.target)instanceof HTMLDetailsElement))return;let d=s.target,c=((m=i.get(e))!=null?m:[]).indexOf(d);if(c===-1)return;let p=[];e.multiple?p=d.open?e.open.concat([c]):e.open.filter(L=>L!==c):p=d.open?[c]:[],o.update(e,p)}};y(b,"options",{attributeFilter:["open"],attributes:!0,childList:!0,subtree:!0});var a=class{};y(a,"details",{buttons:new WeakMap,containers:new WeakMap}),y(a,"list",{children:new WeakMap,observer:new WeakMap,open:new WeakMap});var h=class extends HTMLElement{get open(){var e,t;return(t=(e=a.details.containers.get(this))==null?void 0:e.open)!=null?t:!1}set open(e){o.onToggle.call(this,e)}connectedCallback(){let e=this.querySelector(":scope > details"),t=e==null?void 0:e.querySelector(":scope > summary");a.details.buttons.set(this,t),a.details.containers.set(this,e)}disconnectedCallback(){a.details.buttons.delete(this),a.details.containers.delete(this)}toggle(){o.onToggle.call(this)}},E=class extends HTMLElement{static get observedAttributes(){return["multiple","open"]}get multiple(){return this.getAttribute("multiple")!=null}set multiple(e){w(this,"multiple",e?"":null)}get open(){var e;return(e=a.list.open.get(this))!=null?e:[]}set open(e){o.update(this,e)}constructor(){super(),this.addEventListener("keydown",o.onLocalKeydown.bind(this),T.passive)}attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multiple":o.open(this,D(this,"open",""));break;case"open":o.open(this,i);break;default:break}}connectedCallback(){o.initializeList(this)}disconnectedCallback(){o.destroyList(this)}};globalThis.addEventListener("keydown",o.onGlobalKeydown,T.passive);globalThis.customElements.define("delicious-details",h);globalThis.customElements.define("delicious-details-list",E);
