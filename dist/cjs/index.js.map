{
  "version": 3,
  "sources": ["../../src/details.ts"],
  "sourcesContent": ["const keyEventOptions = {capture: false, passive: true};\n\nclass DetailsHandler {\n\tstatic escape(event: KeyboardEvent): void {\n\t\tif (event.key !== 'Escape') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet parent = document.activeElement?.parentElement;\n\n\t\twhile (parent != null) {\n\t\t\tif (parent === document.body) {\n\t\t\t\tparent = null;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parent instanceof DeliciousDetails && (Store.details.containers.get(parent)?.open ?? true)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tparent = parent.parentElement;\n\t\t}\n\n\t\tif (parent != null) {\n\t\t\tDetailsHandler.toggle(parent, false);\n\t\t}\n\t}\n\n\tstatic toggle(component: DeliciousDetails, open?: boolean): void {\n\t\tconst {buttons, containers} = Store.details;\n\n\t\tconst container = containers.get(component);\n\n\t\tif (container == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tcontainer.open = open ?? !container.open;\n\n\t\tif (!container.open) {\n\t\t\tbuttons.get(component)?.focus();\n\t\t}\n\t}\n}\n\nclass ListHandler {\n\tstatic getChildren(component: DeliciousDetailsList): HTMLDetailsElement[] {\n\t\treturn Array.from(component.querySelectorAll(':scope > delicious-details > details, :scope > details'));\n\t}\n\n\tstatic open(component: DeliciousDetailsList, value: string | undefined): void {\n\t\tif (value == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (value.length > 0 && !/^[\\s\\d,]+$/.test(value)) {\n\t\t\tthrow new Error('The \\'selected\\'-attribute of a \\'delicious-details-list\\'-element must be a comma-separated string of numbers, e.g. \\'\\', \\'0\\' or \\'0,1,2\\'');\n\t\t}\n\n\t\tconst parts = value.length > 0\n\t\t\t? value\n\t\t\t\t.split(',')\n\t\t\t\t.filter(index => index.trim().length > 0)\n\t\t\t\t.map(index => Number.parseInt(index, 10))\n\t\t\t: [];\n\n\t\tthis.update(component, parts);\n\t}\n\n\tstatic traverse(component: DeliciousDetailsList, event: KeyboardEvent): void {\n\t\tif (event.isComposing || (event.key !== 'ArrowDown' && event.key !== 'ArrowUp')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {target} = event;\n\n\t\tif (!(target instanceof HTMLElement)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst children = Store.list.children.get(component) ?? [];\n\t\tconst parent = target.parentElement;\n\t\tconst index = children.indexOf(parent as HTMLDetailsElement);\n\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet position = index + (event.key === 'ArrowDown' ? 1 : -1);\n\n\t\tif (position < 0) {\n\t\t\tposition = children.length - 1;\n\t\t} else if (position >= children.length) {\n\t\t\tposition = 0;\n\t\t}\n\n\t\tconst details = children[position];\n\t\tconst summary = details?.querySelector(':scope > summary');\n\n\t\t(summary as HTMLButtonElement)?.focus();\n\t}\n\n\tstatic update(component: DeliciousDetailsList, selection: number[] | undefined): void {\n\t\tif (typeof selection === 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tlet sorted = selection\n\t\t\t.filter((v, i, a) => a.indexOf(v) === i)\n\t\t\t.sort((f, s) => f - s);\n\n\t\tif (!component.multiple) {\n\t\t\tsorted = sorted.length > 0 && sorted[0] != null\n\t\t\t\t? sorted.length > 1\n\t\t\t\t\t? [sorted[0]]\n\t\t\t\t\t: sorted\n\t\t\t\t: [];\n\t\t}\n\n\t\tif (sorted.every((v, i) => component.open[i] === v)) {\n\t\t\treturn;\n\t\t}\n\n\t\tobserver.get(component)?.disconnect();\n\n\t\tconst elements = children.get(component) ?? [];\n\n\t\tfor (const element of elements) {\n\t\t\tif (sorted.includes(elements.indexOf(element)) !== element.open) {\n\t\t\t\telement.open = !element.open;\n\t\t\t}\n\t\t}\n\n\t\topen.set(component, sorted);\n\n\t\tdelay(() => {\n\t\t\tif (sorted.length === 0) {\n\t\t\t\tcomponent.removeAttribute('open');\n\t\t\t} else {\n\t\t\t\tcomponent.setAttribute('open', sorted.join(','));\n\t\t\t}\n\n\t\t\tdelay(() => observer.get(component)?.observe(component, Observer.options));\n\t\t});\n\t}\n}\n\nclass Observer {\n\tstatic readonly options: MutationObserverInit = {\n\t\tattributeFilter: ['open'],\n\t\tattributes: true,\n\t\tchildList: true,\n\t\tsubtree: true,\n\t};\n\n\tstatic callback(component: DeliciousDetailsList, records: MutationRecord[]): void {\n\t\tif (records.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {children} = Store.list;\n\t\tconst record = records[0];\n\t\tconst added = Array.from(record?.addedNodes ?? []);\n\t\tconst removed = Array.from(record?.removedNodes ?? []);\n\n\t\tif (added.concat(removed).some(element => element.parentElement === component)) {\n\t\t\tchildren.set(component, ListHandler.getChildren(component));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (record?.type !== 'attributes' || !(record?.target instanceof HTMLDetailsElement)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = record.target;\n\t\tconst elements = children.get(component) ?? [];\n\t\tconst index = elements.indexOf(element);\n\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet selection: number[] = [];\n\n\t\tif (component.multiple) {\n\t\t\tselection = element.open\n\t\t\t\t? component.open.concat([index])\n\t\t\t\t: component.open.filter(v => v !== index);\n\t\t} else {\n\t\t\tselection = element.open ? [index] : [];\n\t\t}\n\n\t\tListHandler.update(component, selection);\n\t}\n}\n\nclass Store {\n\tstatic readonly details = {\n\t\tbuttons: new WeakMap<DeliciousDetails, HTMLButtonElement>(),\n\t\tcontainers: new WeakMap<DeliciousDetails, HTMLDetailsElement>(),\n\t};\n\n\tstatic readonly list = {\n\t\tchildren: new WeakMap<DeliciousDetailsList, HTMLDetailsElement[]>(),\n\t\tobserver: new WeakMap<DeliciousDetailsList, MutationObserver>(),\n\t\topen: new WeakMap<DeliciousDetailsList, number[]>(),\n\t};\n}\n\nfunction delay(callback: () => void): number {\n\treturn requestAnimationFrame?.(callback) ?? setTimeout?.(callback, 16);\n}\n\nclass DeliciousDetails extends HTMLElement {\n\tclose(): void {\n\t\tDetailsHandler.toggle(this, false);\n\t}\n\n\tconnectedCallback(): void {\n\t\tconst details = this.querySelector(':scope > details')!;\n\t\tconst summary = details?.querySelector(':scope > summary');\n\n\t\tStore.details.buttons.set(this, summary as HTMLButtonElement);\n\t\tStore.details.containers.set(this, details as HTMLDetailsElement);\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tStore.details.buttons.delete(this);\n\t\tStore.details.containers.delete(this);\n\t}\n\n\topen(): void {\n\t\tDetailsHandler.toggle(this, true);\n\t}\n\n\ttoggle(): void {\n\t\tDetailsHandler.toggle(this);\n\t}\n}\n\nclass DeliciousDetailsList extends HTMLElement {\n\tstatic get observedAttributes() {\n\t\treturn ['multiple', 'open'];\n\t}\n\n\tget multiple(): boolean {\n\t\treturn this.getAttribute('multiple') != null;\n\t}\n\n\tset multiple(multiple: boolean) {\n\t\tif (multiple) {\n\t\t\tthis.setAttribute('multiple', '');\n\t\t} else {\n\t\t\tthis.removeAttribute('multiple');\n\t\t}\n\t}\n\n\tget open(): number[] {\n\t\treturn Store.list.open.get(this) ?? [];\n\t}\n\n\tset open(indices: number[]) {\n\t\tListHandler.update(this, indices);\n\t}\n\n\tattributeChangedCallback(name: string, oldValue: string, newValue: string): void {\n\t\tif (oldValue === newValue) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (name) {\n\t\t\tcase 'multiple':\n\t\t\t\tListHandler.open(this, this.getAttribute('open') ?? undefined);\n\t\t\t\tbreak;\n\t\t\tcase 'open':\n\t\t\t\tListHandler.open(this, newValue);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconnectedCallback(): void {\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tchildren.set(this, ListHandler.getChildren(this));\n\t\topen.set(this, []);\n\n\t\tobserver.set(this, new MutationObserver(records => {\n\t\t\tObserver.callback(this, records);\n\t\t}));\n\n\t\tobserver.get(this)?.observe(this, Observer.options);\n\n\t\tthis.addEventListener('keydown', event => {\n\t\t\tListHandler.traverse(this, event);\n\t\t}, keyEventOptions);\n\n\t\tListHandler.open(this, this.getAttribute('open') ?? undefined);\n\t}\n\n\tdisconnectedCallback(): void {\n\t\tconst {children, observer, open} = Store.list;\n\n\t\tchildren.delete(this);\n\t\tobserver.get(this)?.disconnect();\n\t\tobserver.delete(this);\n\t\topen.delete(this);\n\t}\n}\n\naddEventListener?.('keyup', DetailsHandler.escape, keyEventOptions);\n\ncustomElements?.define('delicious-details', DeliciousDetails);\ncustomElements?.define('delicious-details-list', DeliciousDetailsList);\n"],
  "mappings": "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",
  "names": ["keyEventOptions", "DetailsHandler", "event", "_a", "_b", "_c", "parent", "DeliciousDetails", "Store", "component", "open", "buttons", "containers", "container", "ListHandler", "value", "parts", "index", "target", "children", "position", "details", "summary", "selection", "observer", "sorted", "v", "i", "a", "f", "s", "elements", "element", "delay", "Observer", "records", "record", "added", "removed", "__publicField", "callback", "DeliciousDetailsList", "multiple", "indices", "name", "oldValue", "newValue"]
}
